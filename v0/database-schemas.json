{
  "version": "1.0.0",
  "generated": "2025-10-12",
  "description": "Complete database schemas for Novunt API - Source of truth from actual Mongoose models",
  "database": "MongoDB with Mongoose ODM",
  "schemas": {
    "User": {
      "collectionName": "users",
      "description": "Core user account information with authentication, security, referral system, and rank management",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "description": "Unique identifier for the user",
          "auto": true
        },
        "fname": {
          "type": "String",
          "required": true,
          "description": "User's first name",
          "validation": "Required field"
        },
        "lname": {
          "type": "String",
          "required": true,
          "description": "User's last name",
          "validation": "Required field"
        },
        "username": {
          "type": "String",
          "required": true,
          "unique": true,
          "description": "Unique username for the account",
          "validation": "Must be unique, trimmed, and lowercase"
        },
        "email": {
          "type": "String",
          "required": true,
          "unique": true,
          "description": "User's email address",
          "validation": "Must be valid email format (regex: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/), lowercase, trimmed"
        },
        "password": {
          "type": "String",
          "required": true,
          "select": false,
          "description": "Hashed password using bcrypt",
          "validation": "Minimum 8 characters, must contain uppercase, lowercase, number, and special character (@_$!%*?&)",
          "security": "Auto-hashed on save, never returned in queries by default"
        },
        "profilePicture": {
          "type": "String",
          "required": false,
          "description": "URL to user's profile picture"
        },
        "twoFAEnabled": {
          "type": "Boolean",
          "default": false,
          "description": "Whether two-factor authentication is enabled"
        },
        "twoFASecret": {
          "type": "String",
          "required": false,
          "description": "Secret key for Google Authenticator 2FA"
        },
        "role": {
          "type": "String",
          "enum": ["admin", "superAdmin", "user"],
          "default": "user",
          "description": "User's role for authorization"
        },
        "referrer": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Reference to the user who referred this user"
        },
        "referralCode": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "required": false,
          "description": "Unique referral code for this user to share",
          "validation": "Unique when set, allows multiple null values"
        },
        "referralBonusBalance": {
          "type": "Number",
          "default": 0,
          "description": "Accumulated referral bonus balance (legacy field)"
        },
        "referralDepletionStartDate": {
          "type": "Date",
          "required": false,
          "description": "Date when referral earnings depletion process started"
        },
        "referralDepletionWarningDate": {
          "type": "Date",
          "required": false,
          "description": "Date when user was warned about referral earnings depletion"
        },
        "isReferralEarningsStopped": {
          "type": "Boolean",
          "default": false,
          "description": "Whether referral earnings are stopped due to inactivity"
        },
        "hasQualifyingStake": {
          "type": "Boolean",
          "default": false,
          "description": "Whether user has an active qualifying stake"
        },
        "fcmTokens": {
          "type": "Array<String>",
          "default": [],
          "description": "Firebase Cloud Messaging tokens for push notifications"
        },
        "phoneNumber": {
          "type": "String",
          "sparse": true,
          "required": false,
          "description": "User's phone number"
        },
        "countryCode": {
          "type": "String",
          "sparse": true,
          "required": false,
          "description": "Country code for phone number"
        },
        "telegramChatId": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "required": false,
          "description": "Telegram chat ID for notifications"
        },
        "emailVerified": {
          "type": "Boolean",
          "default": false,
          "required": true,
          "description": "Whether email has been verified"
        },
        "emailVerificationCode": {
          "type": "String",
          "select": false,
          "required": false,
          "description": "Code sent to email for verification"
        },
        "emailVerificationExpires": {
          "type": "Date",
          "select": false,
          "required": false,
          "description": "Expiration time for email verification code"
        },
        "failedLoginAttempts": {
          "type": "Number",
          "default": 0,
          "description": "Number of consecutive failed login attempts"
        },
        "lockoutUntil": {
          "type": "Date",
          "default": null,
          "description": "Account lockout expiration time (after 5 failed attempts, locked for 15 minutes)"
        },
        "lastFailedLogin": {
          "type": "Date",
          "default": null,
          "description": "Timestamp of last failed login attempt"
        },
        "tokenVersion": {
          "type": "Number",
          "default": 0,
          "description": "Version number for JWT tokens (incremented to invalidate all tokens)"
        },
        "rank": {
          "type": "String",
          "enum": [
            "Stakeholder",
            "Associate Stakeholder",
            "Principal Strategist",
            "Elite Capitalist",
            "Wealth Architect",
            "Finance Titan"
          ],
          "default": "Stakeholder",
          "description": "User's current rank in the platform hierarchy"
        },
        "directDownlines": {
          "type": "Array<ObjectId>",
          "ref": "User",
          "default": [],
          "description": "Array of user IDs directly referred by this user"
        },
        "teamStake": {
          "type": "Number",
          "default": 0,
          "description": "Total stake amount from entire team (downline)"
        },
        "personalStake": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Total personal stake amount by this user"
        },
        "rankQualificationStatus": {
          "type": "String",
          "enum": ["qualified", "not_qualified", "pending_verification"],
          "default": "not_qualified",
          "description": "Current rank qualification status"
        },
        "lastRankVerification": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last time rank qualification was verified"
        },
        "rankPoolQualified": {
          "type": "Boolean",
          "default": false,
          "description": "Whether qualified for rank pool (Performance Pool - Blue Tick)"
        },
        "redistributionPoolQualified": {
          "type": "Boolean",
          "default": false,
          "description": "Whether qualified for redistribution pool (Premium Pool - Green Tick)"
        },
        "isActive": {
          "type": "Boolean",
          "default": true,
          "description": "Whether user account is active"
        },
        "resetSecret": {
          "type": "String",
          "select": false,
          "required": false,
          "description": "Secret for password reset"
        },
        "resetToken": {
          "type": "String",
          "select": false,
          "required": false,
          "description": "Token for password reset"
        },
        "resetTokenExpiration": {
          "type": "Number",
          "select": false,
          "required": false,
          "description": "Expiration timestamp for reset token"
        },
        "createdAt": {
          "type": "Date",
          "auto": true,
          "description": "Account creation timestamp"
        },
        "updatedAt": {
          "type": "Date",
          "auto": true,
          "description": "Last update timestamp"
        }
      },
      "indexes": [
        {
          "field": "email",
          "unique": true
        },
        {
          "field": "username",
          "unique": true
        },
        {
          "field": "referralCode",
          "unique": true,
          "sparse": true
        },
        {
          "field": "telegramChatId",
          "unique": true,
          "sparse": true
        }
      ],
      "methods": {
        "comparePassword": {
          "description": "Compare provided password with hashed password",
          "parameters": ["candidatePassword: string"],
          "returns": "Promise<boolean>"
        },
        "isLocked": {
          "description": "Check if account is currently locked due to failed login attempts",
          "parameters": [],
          "returns": "boolean"
        },
        "incrementLoginAttempts": {
          "description": "Increment failed login attempts and lock account if threshold reached",
          "parameters": [],
          "returns": "Promise<number>"
        },
        "resetLoginAttempts": {
          "description": "Reset failed login attempts counter",
          "parameters": [],
          "returns": "Promise<void>"
        }
      },
      "hooks": {
        "pre-save": "Hashes password using BetterAuth hashPassword function before saving"
      }
    },
    "UserWallet": {
      "collectionName": "userwallets",
      "description": "Two-wallet system for managing user funds - Funded Wallet (deposits/transfers) and Earning Wallet (platform earnings)",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true,
          "description": "Unique identifier for the wallet"
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true,
          "description": "Reference to the user who owns this wallet"
        },
        "balance": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Legacy balance field (deprecated, use fundedWallet + earningWallet)"
        },
        "currency": {
          "type": "String",
          "default": "USDT",
          "description": "Wallet currency"
        },
        "walletAddress": {
          "type": "String",
          "sparse": true,
          "required": false,
          "description": "External wallet address for withdrawals"
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Duplicate reference to user (legacy compatibility)"
        },
        "fundedWallet": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "required": true,
          "description": "Holds deposits and P2P transfers. Can ONLY be used for staking, NOT for withdrawals",
          "businessLogic": "Source: deposits, P2P transfers | Usage: staking only"
        },
        "earningWallet": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "required": true,
          "description": "Holds all platform earnings. Can be used for both staking AND withdrawals",
          "businessLogic": "Source: Stake Pool, Performance Pool, Premium Pool, bonuses, referrals | Usage: staking + withdrawals"
        },
        "totalDeposited": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all deposits"
        },
        "totalWithdrawn": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all withdrawals"
        },
        "totalStaked": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all stakes created"
        },
        "totalStakeReturns": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all stake returns received"
        },
        "totalTransferSent": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all P2P transfers sent"
        },
        "totalTransferReceived": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Cumulative total of all P2P transfers received"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now",
          "description": "Wallet creation timestamp"
        },
        "lastUpdated": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last wallet update timestamp"
        }
      },
      "indexes": [
        {
          "field": "userId",
          "unique": true
        }
      ],
      "methods": {
        "getTotalBalance": {
          "description": "Get total balance across both wallets",
          "parameters": [],
          "returns": "number",
          "calculation": "fundedWallet + earningWallet"
        },
        "getAvailableBalance": {
          "description": "Alias for getTotalBalance",
          "parameters": [],
          "returns": "number"
        },
        "canStake": {
          "description": "Check if user has sufficient funds to stake (minimum 20 USDT)",
          "parameters": ["amount: number (default: 20)"],
          "returns": "boolean",
          "logic": "getTotalBalance() >= amount"
        },
        "canWithdraw": {
          "description": "Check if user can withdraw specified amount (only from earning wallet)",
          "parameters": ["amount: number"],
          "returns": "boolean",
          "logic": "earningWallet >= amount"
        },
        "getWithdrawableAmount": {
          "description": "Get amount available for withdrawal",
          "parameters": [],
          "returns": "number",
          "logic": "Returns earningWallet value only"
        },
        "getStakableAmount": {
          "description": "Get total amount available for staking",
          "parameters": [],
          "returns": "number",
          "logic": "Returns fundedWallet + earningWallet"
        }
      },
      "businessRules": {
        "fundedWallet": "Deposits and transfers go here. Can ONLY stake from this wallet, CANNOT withdraw",
        "earningWallet": "All earnings go here. Can both stake AND withdraw from this wallet",
        "minimumStake": "20 USDT",
        "walletSeparation": "Withdrawals can ONLY come from earningWallet, never from fundedWallet"
      }
    },
    "Transaction": {
      "collectionName": "transactions",
      "description": "Records all financial transactions including deposits, withdrawals, transfers, and bonuses",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true,
          "description": "Unique identifier for the transaction"
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "description": "User who initiated or is the primary party in the transaction"
        },
        "type": {
          "type": "String",
          "enum": ["deposit", "withdrawal", "transfer", "bonus"],
          "required": true,
          "description": "Type of transaction"
        },
        "amount": {
          "type": "Number",
          "required": true,
          "description": "Transaction amount in USD"
        },
        "reference": {
          "type": "String",
          "required": true,
          "unique": true,
          "description": "Unique reference code for the transaction"
        },
        "status": {
          "type": "String",
          "enum": ["pending", "confirmed", "failed"],
          "required": true,
          "description": "Current status of the transaction"
        },
        "txId": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "required": false,
          "description": "Blockchain or payment processor transaction ID"
        },
        "fromUser": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Source user for transfer transactions"
        },
        "toUser": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Destination user for transfer transactions"
        },
        "fee": {
          "type": "Number",
          "required": false,
          "description": "Transaction fee amount"
        },
        "netAmount": {
          "type": "Number",
          "required": false,
          "description": "Net amount after fees"
        },
        "requiresAdminApproval": {
          "type": "Boolean",
          "default": false,
          "description": "Whether transaction requires admin approval"
        },
        "processedAt": {
          "type": "Date",
          "required": false,
          "description": "When the transaction was processed"
        },
        "walletAddress": {
          "type": "String",
          "required": false,
          "description": "Cryptocurrency wallet address for deposits/withdrawals"
        },
        "method": {
          "type": "String",
          "enum": ["nowpayments", "internal", "bonus", "manual"],
          "required": false,
          "description": "Payment or processing method"
        },
        "note": {
          "type": "String",
          "required": false,
          "description": "Additional notes or description"
        },
        "timestamp": {
          "type": "Date",
          "default": "Date.now",
          "description": "Transaction creation timestamp"
        }
      },
      "indexes": [
        {
          "field": "reference",
          "unique": true
        },
        {
          "field": "user"
        },
        {
          "field": "status"
        },
        {
          "field": "timestamp",
          "order": "descending"
        }
      ]
    },
    "Stake": {
      "collectionName": "stakes",
      "description": "Goal-based staking system with 200% return target. Supports regular stakes and bonus stakes from registration",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true,
          "description": "Unique identifier for the stake"
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "description": "User who created the stake"
        },
        "amount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "Stake amount in USD"
        },
        "goalDescription": {
          "type": "String",
          "required": false,
          "maxLength": 200,
          "description": "Optional description of staking goal"
        },
        "duration": {
          "type": "Number",
          "required": true,
          "default": 0,
          "min": 0,
          "description": "Duration in days. 0 = permanent stake until 200% achieved"
        },
        "status": {
          "type": "String",
          "enum": ["active", "completed", "cancelled", "paused"],
          "default": "active",
          "description": "Current stake status"
        },
        "type": {
          "type": "String",
          "enum": ["regular", "registration_bonus", "referral_bonus"],
          "default": "regular",
          "description": "Type of stake"
        },
        "isRegistrationBonus": {
          "type": "Boolean",
          "default": false,
          "description": "Whether this is a registration bonus stake"
        },
        "registrationBonusId": {
          "type": "ObjectId",
          "ref": "RegistrationBonus",
          "required": false,
          "description": "Reference to registration bonus if applicable"
        },
        "maxReturnMultiplier": {
          "type": "Number",
          "default": 2.0,
          "min": 1.0,
          "max": 3.0,
          "description": "Maximum return multiplier (2.0 = 200% for regular, 1.0 = 100% for bonus stakes)"
        },
        "startDate": {
          "type": "Date",
          "default": "Date.now",
          "description": "When the stake was created and started"
        },
        "endDate": {
          "type": "Date",
          "required": true,
          "description": "Target completion date (flexible for goal-based stakes)"
        },
        "completedAt": {
          "type": "Date",
          "required": false,
          "description": "When stake reached completion (200% or 100% for bonus)"
        },
        "totalReturnsEarned": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Total returns earned to date"
        },
        "weeklyReturnsHistory": {
          "type": "Array<Object>",
          "description": "Historical record of weekly returns",
          "schema": {
            "week": {
              "type": "Number",
              "required": true,
              "min": 1,
              "description": "Week number"
            },
            "date": {
              "type": "Date",
              "required": true,
              "description": "Date of distribution"
            },
            "percentage": {
              "type": "Number",
              "required": true,
              "min": 0,
              "max": 100,
              "description": "Percentage distributed this week"
            },
            "amount": {
              "type": "Number",
              "required": true,
              "min": 0,
              "description": "Amount distributed this week"
            },
            "cumulativeAmount": {
              "type": "Number",
              "required": true,
              "min": 0,
              "description": "Cumulative amount earned to date"
            }
          }
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "description": "Alias for userId (legacy compatibility)"
        },
        "isBonus": {
          "type": "Boolean",
          "description": "Deprecated - use type field instead"
        },
        "roiPaid": {
          "type": "Boolean",
          "description": "Deprecated - use status field instead"
        },
        "maturityDate": {
          "type": "Date",
          "description": "Deprecated - use endDate instead"
        },
        "roiAmount": {
          "type": "Number",
          "description": "Deprecated - use totalReturnsEarned instead"
        },
        "createdAt": {
          "type": "Date",
          "auto": true,
          "description": "Stake creation timestamp"
        },
        "updatedAt": {
          "type": "Date",
          "auto": true,
          "description": "Last update timestamp"
        }
      },
      "methods": {
        "addWeeklyReturn": {
          "description": "Add a weekly return distribution to the stake",
          "parameters": ["percentage: number", "week: number"],
          "returns": "number (new cumulative amount)"
        },
        "getCurrentWeek": {
          "description": "Calculate current week number since stake started",
          "parameters": [],
          "returns": "number"
        }
      },
      "businessRules": {
        "regularStakes": "Target 200% return (100% profit). Permanent until goal achieved",
        "bonusStakes": "Target 100% return (0% profit). Created from registration bonus",
        "weeklyDistribution": "Returns distributed weekly based on platform performance",
        "completion": "Stake completes when totalReturnsEarned >= (amount * maxReturnMultiplier)"
      }
    },
    "WithdrawalRequest": {
      "collectionName": "withdrawalrequests",
      "description": "Withdrawal requests requiring admin approval",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "description": "User requesting withdrawal"
        },
        "amount": {
          "type": "Number",
          "required": true,
          "description": "Withdrawal amount in USD"
        },
        "status": {
          "type": "String",
          "enum": ["pending", "approved", "rejected"],
          "default": "pending",
          "description": "Request status"
        },
        "txId": {
          "type": "String",
          "required": false,
          "description": "Transaction ID after processing"
        },
        "requestedAt": {
          "type": "Date",
          "default": "Date.now",
          "description": "When request was made"
        },
        "processedAt": {
          "type": "Date",
          "required": false,
          "description": "When request was approved/rejected"
        },
        "reason": {
          "type": "String",
          "required": false,
          "description": "Rejection reason if applicable"
        }
      }
    },
    "WeeklyProfit": {
      "collectionName": "weeklyprofits",
      "description": "Three-tier pool system for weekly profit distribution: Stake Pool, Performance Pool, and Premium Pool",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "weekNumber": {
          "type": "Number",
          "required": true,
          "unique": true,
          "description": "Sequential week number"
        },
        "stakePoolAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "TIER 1: Proportional distribution to all active stakes"
        },
        "performancePoolAmount": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "TIER 2: Equal distribution within ranks (Blue Tick qualified users)"
        },
        "premiumPoolAmount": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "TIER 3: Leadership qualified distribution (Green Tick qualified users)"
        },
        "totalPoolAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "Sum of all three pool amounts"
        },
        "profitAmount": {
          "type": "Number",
          "required": false,
          "description": "Deprecated - use stakePoolAmount"
        },
        "profitPercentage": {
          "type": "Number",
          "required": false,
          "description": "Deprecated - old percentage model"
        },
        "startDate": {
          "type": "Date",
          "required": true,
          "description": "Week start date"
        },
        "endDate": {
          "type": "Date",
          "required": true,
          "description": "Week end date"
        },
        "isDistributed": {
          "type": "Boolean",
          "default": false,
          "description": "Whether profits have been distributed"
        },
        "distributedAt": {
          "type": "Date",
          "required": false,
          "description": "When distribution occurred"
        },
        "distributedBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Admin who triggered distribution"
        },
        "declaredBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "Admin who declared the profits"
        },
        "declaredAt": {
          "type": "Date",
          "required": false,
          "description": "When profits were declared"
        },
        "createdAt": {
          "type": "Date",
          "auto": true
        },
        "updatedAt": {
          "type": "Date",
          "auto": true
        }
      },
      "indexes": [
        {
          "field": "weekNumber",
          "unique": true
        }
      ],
      "businessRules": {
        "distributionTiers": "Three pools distributed independently based on qualification",
        "stakePool": "Distributed proportionally to all active stakes",
        "performancePool": "Equal distribution to rank-qualified users (Blue Tick)",
        "premiumPool": "Distribution to leadership-qualified users (Green Tick)"
      }
    },
    "KYCSubmission": {
      "collectionName": "kycsubmissions",
      "description": "KYC (Know Your Customer) verification submissions",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "fullName": {
          "type": "String",
          "required": true,
          "description": "Full legal name"
        },
        "documentType": {
          "type": "String",
          "required": true,
          "description": "Type of ID document (passport, national_id, drivers_license)"
        },
        "documentNumber": {
          "type": "String",
          "required": true,
          "description": "Document identification number"
        },
        "documentImageUrl": {
          "type": "String",
          "required": true,
          "description": "URL to uploaded document image"
        },
        "selfieImageUrl": {
          "type": "String",
          "required": true,
          "description": "URL to uploaded selfie for verification"
        },
        "status": {
          "type": "String",
          "enum": ["pending", "approved", "rejected"],
          "default": "pending"
        },
        "submittedAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "reviewedAt": {
          "type": "Date",
          "required": false
        }
      }
    },
    "UserProfile": {
      "collectionName": "userprofiles",
      "description": "Extended user profile information including social media verification and ID verification for registration bonus eligibility",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "firstName": {
          "type": "String",
          "required": false
        },
        "lastName": {
          "type": "String",
          "required": false
        },
        "fullName": {
          "type": "String",
          "required": false,
          "description": "Required for registration bonus"
        },
        "username": {
          "type": "String",
          "required": false,
          "unique": true,
          "description": "Required and unique"
        },
        "dateOfBirth": {
          "type": "Date",
          "required": false,
          "description": "Required for registration bonus"
        },
        "gender": {
          "type": "String",
          "required": false,
          "description": "Required for registration bonus"
        },
        "profilePhoto": {
          "type": "String",
          "required": false
        },
        "bio": {
          "type": "String",
          "required": false
        },
        "email": {
          "type": "String",
          "required": false,
          "description": "Required for registration bonus"
        },
        "phone": {
          "type": "String",
          "required": false,
          "description": "Required for registration bonus (flagged if reused, no OTP verification)"
        },
        "alternativePhone": {
          "type": "String",
          "required": false
        },
        "address": {
          "type": "Object",
          "required": false,
          "description": "Required for registration bonus",
          "schema": {
            "street": "String",
            "city": "String",
            "state": "String",
            "country": "String",
            "postalCode": "String",
            "coordinates": {
              "latitude": "Number",
              "longitude": "Number"
            }
          }
        },
        "deviceFingerprint": {
          "type": "String",
          "required": false,
          "description": "Required for fraud detection in registration bonus"
        },
        "socialMediaHandle": {
          "type": "String",
          "required": false,
          "description": "Required (Facebook handle) for registration bonus"
        },
        "socialMediaAccounts": {
          "type": "Array<Object>",
          "description": "Social media platform verifications",
          "schema": {
            "platform": {
              "type": "String",
              "description": "youtube, facebook, tiktok, instagram, telegram"
            },
            "handle": "String",
            "url": "String",
            "isFollowing": "Boolean",
            "verifiedAt": "Date",
            "verificationMethod": "String",
            "followerCount": "Number",
            "accountAge": "Date",
            "isVerified": "Boolean"
          }
        },
        "idVerification": {
          "type": "Object",
          "schema": {
            "documentType": "String",
            "documentNumber": "String",
            "documentImage": "String",
            "selfieImage": "String",
            "status": {
              "type": "String",
              "enum": ["pending", "verified", "rejected", "not_required"]
            },
            "verifiedAt": "Date",
            "rejectionReason": "String",
            "verifiedBy": "ObjectId"
          }
        },
        "referralCode": {
          "type": "String",
          "required": false
        },
        "referredBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": false
        },
        "completionPercentage": {
          "type": "Number",
          "description": "Profile completion percentage"
        },
        "completedFields": {
          "type": "Array<String>",
          "description": "List of completed profile fields"
        },
        "missingFields": {
          "type": "Array<String>",
          "description": "List of missing required fields"
        },
        "lastUpdated": {
          "type": "Date"
        }
      }
    },
    "RegistrationBonus": {
      "collectionName": "registrationbonuses",
      "description": "Tracks registration bonus eligibility, requirements completion, and fraud detection",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "status": {
          "type": "String",
          "enum": [
            "pending",
            "requirements_met",
            "bonus_active",
            "expired",
            "completed",
            "cancelled"
          ],
          "description": "Current status of registration bonus process"
        },
        "bonusPercentage": {
          "type": "Number",
          "description": "Bonus percentage (e.g., 10 for 10%)"
        },
        "firstStakeAmount": {
          "type": "Number",
          "required": false,
          "description": "Amount of user's first stake"
        },
        "bonusAmount": {
          "type": "Number",
          "required": false,
          "description": "Calculated bonus amount"
        },
        "bonusStakeId": {
          "type": "ObjectId",
          "ref": "Stake",
          "required": false,
          "description": "Reference to created bonus stake"
        },
        "socialMediaVerifications": {
          "type": "Array<Object>",
          "description": "Social media verification statuses",
          "schema": {
            "platform": {
              "type": "String",
              "enum": ["youtube", "facebook", "tiktok", "instagram", "telegram"]
            },
            "isVerified": "Boolean",
            "verifiedAt": "Date",
            "accountHandle": "String",
            "verificationMethod": "String",
            "verificationData": "Mixed"
          }
        },
        "profileCompletion": {
          "type": "Array<Object>",
          "description": "Profile field completion tracking",
          "schema": {
            "fieldName": "String",
            "isCompleted": "Boolean",
            "completedAt": "Date",
            "value": "String"
          }
        },
        "profileCompletionPercentage": {
          "type": "Number"
        },
        "firstStakeCompleted": {
          "type": "Boolean"
        },
        "firstStakeId": {
          "type": "ObjectId",
          "ref": "Stake",
          "required": false
        },
        "registrationDate": {
          "type": "Date"
        },
        "deadline": {
          "type": "Date",
          "description": "7-day deadline to complete requirements"
        },
        "requirementCompletedAt": {
          "type": "Date",
          "required": false
        },
        "bonusActivatedAt": {
          "type": "Date",
          "required": false
        },
        "bonusCompletedAt": {
          "type": "Date",
          "required": false
        },
        "fraudDetection": {
          "type": "Object",
          "description": "Anti-fraud detection data",
          "schema": {
            "deviceFingerprint": "String",
            "ipAddress": "String",
            "geoLocation": {
              "country": "String",
              "city": "String",
              "latitude": "Number",
              "longitude": "Number"
            },
            "browserInfo": {
              "userAgent": "String",
              "language": "String",
              "platform": "String",
              "screen": "String",
              "timezone": "String"
            },
            "suspicionScore": {
              "type": "Number",
              "description": "0-100, higher = more suspicious"
            },
            "flaggedReasons": "Array<String>",
            "similarAccounts": "Array<String>"
          }
        },
        "isApproved": {
          "type": "Boolean"
        },
        "approvedBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": false
        },
        "approvedAt": {
          "type": "Date",
          "required": false
        },
        "rejectionReason": {
          "type": "String",
          "required": false
        },
        "settingsSnapshot": {
          "type": "Object",
          "description": "Snapshot of settings when bonus was created",
          "schema": {
            "bonusPercentage": "Number",
            "timeLimit": "Number",
            "maxBonusAmount": "Number",
            "minFirstStake": "Number",
            "requiredSocialPlatforms": "Array<String>"
          }
        }
      },
      "businessRules": {
        "requirements": "Profile completion + social media verification + first stake within 7 days",
        "bonusCalculation": "bonusAmount = firstStakeAmount * (bonusPercentage / 100)",
        "fraudDetection": "Device fingerprint, IP, phone reuse detection",
        "timeline": "7-day deadline from registration to complete all requirements"
      }
    },
    "SystemSettings": {
      "collectionName": "systemsettings",
      "description": "System-wide configuration settings",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "category": {
          "type": "String",
          "required": true,
          "indexed": true,
          "description": "Setting category"
        },
        "key": {
          "type": "String",
          "sparse": true,
          "indexed": true,
          "description": "Setting key"
        },
        "settings": {
          "type": "Mixed",
          "default": {},
          "description": "Setting values object"
        },
        "value": {
          "type": "Mixed",
          "description": "Single setting value"
        },
        "metadata": {
          "type": "Mixed",
          "default": {},
          "description": "Additional metadata"
        },
        "lastUpdatedBy": {
          "type": "ObjectId",
          "ref": "User"
        },
        "lastUpdatedAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "type": {
          "type": "String"
        },
        "displayName": {
          "type": "String"
        },
        "description": {
          "type": "String"
        },
        "isEditable": {
          "type": "Boolean"
        },
        "minValue": {
          "type": "Number"
        },
        "maxValue": {
          "type": "Number"
        },
        "validOptions": {
          "type": "Array"
        },
        "updatedAt": {
          "type": "Date"
        }
      },
      "indexes": [
        {
          "field": "category"
        },
        {
          "field": "key",
          "sparse": true
        }
      ]
    },
    "SecurityLog": {
      "collectionName": "securitylogs",
      "description": "Audit log for security-related events",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "action": {
          "type": "String",
          "required": true,
          "description": "Action type (e.g., 'login', '2fa-verify', 'withdrawal-request')"
        },
        "status": {
          "type": "String",
          "enum": ["success", "failure"],
          "required": true
        },
        "ipAddress": {
          "type": "String",
          "required": false
        },
        "userAgent": {
          "type": "String",
          "required": false
        },
        "details": {
          "type": "String",
          "required": false
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "ReferralBonus": {
      "collectionName": "referralbonuses",
      "description": "5-level referral bonus system (5%, 2%, 1.5%, 1%, 0.5%) with depletion tracking for inactive stakes",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "description": "User who earned the referral bonus"
        },
        "referredUser": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "description": "User who was referred"
        },
        "amount": {
          "type": "Number",
          "required": true,
          "description": "Bonus amount in USD"
        },
        "level": {
          "type": "Number",
          "required": true,
          "min": 1,
          "max": 5,
          "description": "Referral level (1=5%, 2=2%, 3=1.5%, 4=1%, 5=0.5%)"
        },
        "stakeActivatedByDeadline": {
          "type": "Boolean",
          "default": false,
          "description": "Whether referred user activated stake within 7 days"
        },
        "depletionStartedAt": {
          "type": "Date",
          "required": false,
          "description": "When depletion process started (if stake not activated)"
        },
        "depletedPercent": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "max": 100,
          "description": "Percentage of bonus depleted (10% per week)"
        },
        "fullyDepleted": {
          "type": "Boolean",
          "default": false,
          "description": "Whether bonus is fully depleted (100%)"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "businessLogic": {
        "bonusPercentages": "L1: 5%, L2: 2%, L3: 1.5%, L4: 1%, L5: 0.5%",
        "depletionRule": "If referred user doesn't stake within 7 days, bonus depletes 10% per week",
        "destination": "Bonuses go to earningWallet (can stake + withdraw)"
      }
    },
    "RankSystem": {
      "collectionName": "ranksystems",
      "description": "6-tier rank system configuration with requirements and pool distribution settings",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "defaultRank": {
          "type": "String",
          "default": "Stakeholder",
          "required": true,
          "description": "Default rank for new users"
        },
        "ranks": {
          "type": "Array<Object>",
          "description": "Array of rank definitions",
          "structure": {
            "name": "String (rank name)",
            "personalStake": "Number (minimum personal stake required)",
            "teamStake": "Number (minimum team stake required)",
            "directDownlines": "Number (minimum direct referrals required)",
            "lowerRankRequirement": "Number (minimum lower rank downlines)",
            "lowerRankType": "String (which lower rank required)",
            "rankBonusPercent": "Number (bonus percentage for this rank)"
          }
        },
        "poolDistribution": {
          "type": "Object",
          "structure": {
            "frequency": "String (daily, weekly, monthly)",
            "equalDistributionRule": "Boolean",
            "fallbackRule": "String (company_retains, redistribute_equally, hold_for_next_period)",
            "rankAndRedistributionShared": "Boolean",
            "allocationField": "String"
          }
        },
        "redistributionPool": {
          "type": "Object",
          "structure": {
            "qualificationRule": "String (must_have_same_rank_downline, any_qualifying_stake, rank_based)",
            "distributionLogic": "String (equal_split_among_qualified, proportional_to_stake, rank_weighted)",
            "usesRankBonusPercent": "Boolean"
          }
        },
        "verificationIcons": {
          "type": "Object",
          "structure": {
            "rankPoolQualified": "String (blue - qualified for rank pool)",
            "redistributionPoolQualified": "String (green - qualified for redistribution)",
            "requirementShortfallAfterAchievement": "String (red - lost qualification)"
          }
        },
        "isActive": {
          "type": "Boolean",
          "default": true
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "rankTiers": {
        "1": "Stakeholder (default)",
        "2": "Associate Stakeholder",
        "3": "Senior Stakeholder",
        "4": "Executive Stakeholder",
        "5": "Chief Stakeholder",
        "6": "Principal Stakeholder"
      }
    },
    "RankAchievement": {
      "collectionName": "rankachievements",
      "description": "Tracks user rank achievements and ongoing qualification status",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "previousRank": {
          "type": "String",
          "required": true
        },
        "newRank": {
          "type": "String",
          "required": true
        },
        "achievedAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "personalStakeAtAchievement": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "teamStakeAtAchievement": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "directDownlinesAtAchievement": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "lowerRankDownlinesAtAchievement": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "isQualified": {
          "type": "Boolean",
          "default": true,
          "description": "Whether user still meets rank requirements"
        },
        "isActive": {
          "type": "Boolean",
          "default": true
        },
        "lastVerificationDate": {
          "type": "Date",
          "default": "Date.now"
        },
        "shortfalls": {
          "type": "Object",
          "description": "Requirements not met (if any)",
          "structure": {
            "personalStake": "Number (shortfall amount)",
            "teamStake": "Number (shortfall amount)",
            "directDownlines": "Number (shortfall count)",
            "lowerRankDownlines": "Number (shortfall count)"
          }
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "RankDeclaration": {
      "collectionName": "rankdeclarations",
      "description": "Weekly rank pool declarations with approval workflow and distribution tracking",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "weekNumber": {
          "type": "Number",
          "required": true,
          "min": 1,
          "max": 53
        },
        "year": {
          "type": "Number",
          "required": true,
          "min": 2024
        },
        "weekStartDate": {
          "type": "Date",
          "required": true,
          "description": "Monday 00:00 Baker Island Time"
        },
        "weekEndDate": {
          "type": "Date",
          "required": true,
          "description": "Sunday 23:59 Baker Island Time"
        },
        "rankPoolAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "Amount for rank pool distribution"
        },
        "redistributionPoolAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "Amount for redistribution pool"
        },
        "declaredBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "approvedBy": {
          "type": "ObjectId",
          "ref": "User"
        },
        "status": {
          "type": "String",
          "enum": ["pending", "approved", "distributed", "rejected"],
          "default": "pending"
        },
        "eligibleUsersCount": {
          "type": "Number",
          "default": 0
        },
        "redistributionEligibleCount": {
          "type": "Number",
          "default": 0
        },
        "totalDistributed": {
          "type": "Number",
          "default": 0
        },
        "distributionDate": {
          "type": "Date"
        },
        "bakerIslandTime": {
          "type": "Date",
          "required": true
        },
        "notes": {
          "type": "String"
        },
        "auditTrail": {
          "type": "Object",
          "structure": {
            "declaredAt": "Date",
            "approvedAt": "Date",
            "distributedAt": "Date",
            "rejectedAt": "Date",
            "rejectionReason": "String"
          }
        },
        "rankPoolDistributions": {
          "type": "Array<Object>",
          "description": "Distribution breakdown by rank"
        },
        "redistributionDistributions": {
          "type": "Array<Object>",
          "description": "Redistribution pool breakdown"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "PoolDistribution": {
      "collectionName": "pooldistributions",
      "description": "Records of rank pool and redistribution pool distributions to users",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "rankName": {
          "type": "String",
          "required": true
        },
        "distributionType": {
          "type": "String",
          "enum": ["rank_pool", "redistribution_pool"],
          "required": true
        },
        "totalPoolAmount": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "userShare": {
          "type": "Number",
          "required": true,
          "min": 0,
          "max": 1,
          "description": "User's share as decimal (e.g., 0.1 = 10%)"
        },
        "bonusAmount": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "verificationIcon": {
          "type": "String",
          "enum": ["blue", "green", "red"],
          "required": true
        },
        "isQualified": {
          "type": "Boolean",
          "required": true
        },
        "qualificationReason": {
          "type": "String"
        },
        "distributionPeriod": {
          "type": "Date",
          "required": true
        },
        "distributionFrequency": {
          "type": "String",
          "enum": ["daily", "weekly", "monthly"],
          "default": "weekly"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "FinancialLedger": {
      "collectionName": "financialledgers",
      "description": "CRITICAL - Immutable double-entry bookkeeping ledger for all financial operations with complete audit trail",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "entryId": {
          "type": "String",
          "required": true,
          "unique": true,
          "description": "UUID for this specific ledger entry"
        },
        "transactionId": {
          "type": "String",
          "required": true,
          "description": "Reference to main transaction"
        },
        "batchId": {
          "type": "String",
          "description": "For batch operations like weekly distributions"
        },
        "accountType": {
          "type": "String",
          "enum": ["asset", "liability", "equity", "revenue", "expense"],
          "required": true
        },
        "account": {
          "type": "String",
          "required": true,
          "description": "Account name (e.g., user_deposit_wallet, platform_revenue)"
        },
        "debitAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "default": 0,
          "description": "Amount debited (0 if credit)"
        },
        "creditAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "default": 0,
          "description": "Amount credited (0 if debit)"
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "description": "User involved (if applicable)"
        },
        "operationType": {
          "type": "String",
          "enum": ["deposit", "withdrawal", "transfer", "stake", "bonus", "fee", "reconciliation"],
          "required": true
        },
        "description": {
          "type": "String",
          "required": true,
          "maxLength": 500
        },
        "isImmutable": {
          "type": "Boolean",
          "default": false,
          "description": "Once true, cannot be modified"
        },
        "parentEntryId": {
          "type": "String",
          "description": "For reversal entries"
        },
        "isReversal": {
          "type": "Boolean",
          "default": false
        },
        "expectedBalance": {
          "type": "Number",
          "min": 0
        },
        "actualBalance": {
          "type": "Number",
          "min": 0
        },
        "reconciled": {
          "type": "Boolean",
          "default": false
        },
        "reconciledAt": {
          "type": "Date"
        },
        "ipAddress": {
          "type": "String",
          "maxLength": 45
        },
        "userAgent": {
          "type": "String"
        },
        "sessionId": {
          "type": "String"
        },
        "nowPaymentsId": {
          "type": "String"
        },
        "blockchainTxId": {
          "type": "String"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "createdBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "verificationHash": {
          "type": "String",
          "required": true,
          "description": "Hash of entry data for integrity verification"
        }
      },
      "businessLogic": {
        "doubleEntry": "Every transaction creates two entries: debit and credit",
        "immutability": "Entries cannot be deleted, only reversed with new entries",
        "reconciliation": "Regular balance verification against wallet balances"
      }
    },
    "Goal": {
      "collectionName": "goals",
      "description": "User financial goals linked to stakes, targeting 200% return (100% profit)",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "title": {
          "type": "String",
          "required": true,
          "maxLength": 100
        },
        "description": {
          "type": "String",
          "maxLength": 500
        },
        "category": {
          "type": "String",
          "required": true
        },
        "isCustomGoal": {
          "type": "Boolean",
          "default": false,
          "description": "True if user typed custom goal, false if from template"
        },
        "initialStakeAmount": {
          "type": "Number",
          "required": true,
          "min": 20
        },
        "totalReturnsReceived": {
          "type": "Number",
          "default": 0,
          "min": 0
        },
        "progressPercentage": {
          "type": "Number",
          "default": 100,
          "min": 100,
          "max": 200,
          "description": "Starts at 100% (initial stake), targets 200%"
        },
        "status": {
          "type": "String",
          "enum": ["active", "completed"],
          "default": "active"
        },
        "lastMotivationalQuote": {
          "type": "String"
        },
        "lastMilestoneReached": {
          "type": "Number",
          "default": 100
        },
        "stakeDate": {
          "type": "Date",
          "required": true,
          "description": "When stake was created (Baker Island Time)"
        },
        "earningStartDate": {
          "type": "Date",
          "required": true,
          "description": "When earnings start (next day 00:00 Baker Island Time)"
        },
        "nextEarningDate": {
          "type": "Date"
        },
        "isEligibleForWeeklyReturn": {
          "type": "Boolean",
          "default": true
        },
        "remainingToTarget": {
          "type": "Number",
          "description": "How much more needed to reach 200%"
        },
        "weeksActive": {
          "type": "Number",
          "default": 0
        },
        "totalWeeksToCompletion": {
          "type": "Number",
          "description": "Estimated weeks to reach 200%"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "WeeklyDeclaration": {
      "collectionName": "weeklydeclarations",
      "description": "Weekly profit declarations for stake pool distribution with approval workflow",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "weekNumber": {
          "type": "Number",
          "required": true,
          "min": 1,
          "max": 53
        },
        "year": {
          "type": "Number",
          "required": true,
          "min": 2024
        },
        "weekStartDate": {
          "type": "Date",
          "required": true,
          "description": "Monday 00:00 Baker Island Time"
        },
        "weekEndDate": {
          "type": "Date",
          "required": true,
          "description": "Sunday 23:59 Baker Island Time"
        },
        "declaredAmount": {
          "type": "Number",
          "required": true,
          "min": 0,
          "description": "Total amount for stake pool distribution"
        },
        "declaredBy": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "approvedBy": {
          "type": "ObjectId",
          "ref": "User"
        },
        "status": {
          "type": "String",
          "enum": ["pending", "approved", "distributed", "rejected"],
          "default": "pending"
        },
        "eligibleGoalsCount": {
          "type": "Number",
          "default": 0
        },
        "totalDistributed": {
          "type": "Number",
          "default": 0
        },
        "distributionDate": {
          "type": "Date"
        },
        "bakerIslandTime": {
          "type": "Date",
          "required": true
        },
        "notes": {
          "type": "String"
        },
        "auditTrail": {
          "type": "Object",
          "structure": {
            "declaredAt": "Date",
            "approvedAt": "Date",
            "distributedAt": "Date",
            "rejectedAt": "Date",
            "rejectionReason": "String"
          }
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "Notification": {
      "collectionName": "notifications",
      "description": "In-app notifications for users with categorization and action tracking",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "title": {
          "type": "String",
          "required": true,
          "maxLength": 100
        },
        "message": {
          "type": "String",
          "required": true,
          "maxLength": 500
        },
        "type": {
          "type": "String",
          "enum": ["info", "warning", "success", "error", "referral", "depletion", "goal", "system"],
          "required": true
        },
        "category": {
          "type": "String",
          "enum": ["referral_bonus", "goal_progress", "withdrawal", "system", "general"],
          "required": true
        },
        "priority": {
          "type": "String",
          "enum": ["low", "medium", "high", "urgent"],
          "default": "medium"
        },
        "isRead": {
          "type": "Boolean",
          "default": false
        },
        "isArchived": {
          "type": "Boolean",
          "default": false
        },
        "actionRequired": {
          "type": "Boolean",
          "default": false
        },
        "actionUrl": {
          "type": "String",
          "maxLength": 200
        },
        "actionText": {
          "type": "String",
          "maxLength": 50
        },
        "metadata": {
          "type": "Mixed",
          "description": "Additional data (bonusAmount, daysRemaining, depletionRate, goalId, referralLevel, etc.)"
        },
        "expiresAt": {
          "type": "Date",
          "description": "Auto-delete after this date"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "readAt": {
          "type": "Date"
        }
      }
    },
    "UserPreferences": {
      "collectionName": "userpreferences",
      "description": "User application preferences and settings",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true
        },
        "theme": {
          "type": "String",
          "enum": ["light", "dark", "auto"],
          "default": "light"
        },
        "language": {
          "type": "String",
          "default": "en"
        },
        "notifications": {
          "type": "Object",
          "structure": {
            "email": "Boolean (default: true)",
            "push": "Boolean (default: true)",
            "platform": "Boolean (default: true)",
            "newsletter": "Boolean (default: true)"
          }
        },
        "dashboard": {
          "type": "Object",
          "structure": {
            "showWelcomeMessage": "Boolean (default: true)",
            "showActivityFeed": "Boolean (default: true)",
            "feedItemsPerPage": "Number (default: 10, min: 5, max: 50)",
            "compactView": "Boolean (default: false)"
          }
        },
        "accessibility": {
          "type": "Object",
          "structure": {
            "highContrast": "Boolean (default: false)",
            "largeText": "Boolean (default: false)",
            "reducedMotion": "Boolean (default: false)"
          }
        },
        "privacy": {
          "type": "Object",
          "structure": {
            "showOnlineStatus": "Boolean (default: true)",
            "shareActivity": "Boolean (default: true)"
          }
        },
        "customSettings": {
          "type": "Mixed",
          "default": "{}"
        },
        "lastUpdated": {
          "type": "Date",
          "default": "Date.now"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "TempUser": {
      "collectionName": "tempusers",
      "description": "Temporary user data during email verification (auto-deleted after 30 minutes)",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "fname": {
          "type": "String",
          "required": true
        },
        "lname": {
          "type": "String",
          "required": true
        },
        "email": {
          "type": "String",
          "required": true,
          "unique": true
        },
        "username": {
          "type": "String",
          "required": true,
          "unique": true
        },
        "password": {
          "type": "String",
          "required": true,
          "description": "Pre-hashed password"
        },
        "secret": {
          "type": "String",
          "required": true,
          "description": "2FA secret"
        },
        "verificationToken": {
          "type": "String",
          "required": true
        },
        "tokenExpiration": {
          "type": "Number",
          "required": true
        },
        "referralCode": {
          "type": "String",
          "description": "Referral code from referrer"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now",
          "expires": 1800,
          "description": "TTL: 30 minutes (auto-delete)"
        }
      }
    },
    "RefreshToken": {
      "collectionName": "refreshtokens",
      "description": "JWT refresh tokens with revocation support and auto-expiration",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "token": {
          "type": "String",
          "required": true,
          "unique": true
        },
        "jti": {
          "type": "String",
          "required": true,
          "unique": true,
          "description": "JWT ID for token revocation"
        },
        "expiresAt": {
          "type": "Date",
          "required": true,
          "description": "Auto-deleted after expiration (TTL index)"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "ipAddress": {
          "type": "String"
        },
        "userAgent": {
          "type": "String"
        },
        "isRevoked": {
          "type": "Boolean",
          "default": false
        }
      }
    },
    "DepositBonus": {
      "collectionName": "depositbonuses",
      "description": "Deposit bonus tracking for promotional campaigns",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true
        },
        "bonusAmount": {
          "type": "Number",
          "required": true
        },
        "depositId": {
          "type": "ObjectId",
          "ref": "Transaction",
          "required": true,
          "description": "Reference to the deposit transaction"
        },
        "grantedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "Newsletter": {
      "collectionName": "newsletters",
      "description": "Newsletter and announcement management with targeting and analytics",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "title": {
          "type": "String",
          "required": true,
          "maxLength": 200
        },
        "content": {
          "type": "String",
          "required": true,
          "maxLength": 10000
        },
        "excerpt": {
          "type": "String",
          "required": true,
          "maxLength": 500
        },
        "type": {
          "type": "String",
          "enum": ["announcement", "update", "promotion", "educational", "maintenance"],
          "required": true
        },
        "priority": {
          "type": "String",
          "enum": ["low", "medium", "high", "urgent"],
          "default": "medium"
        },
        "targetAudience": {
          "type": "Object",
          "structure": {
            "userRoles": "Array<String> (user, admin, superAdmin)",
            "minStakeAmount": "Number",
            "userStatus": "Array<String>",
            "specificUsers": "Array<ObjectId>",
            "excludeUsers": "Array<ObjectId>"
          }
        },
        "status": {
          "type": "String",
          "enum": ["draft", "scheduled", "published", "archived"],
          "default": "draft"
        },
        "publishedAt": {
          "type": "Date"
        },
        "scheduledFor": {
          "type": "Date"
        },
        "expiresAt": {
          "type": "Date"
        },
        "media": {
          "type": "Object",
          "structure": {
            "coverImage": "String (URL)",
            "attachments": "Array<String> (URLs)",
            "videoUrl": "String"
          }
        },
        "formatting": {
          "type": "Object",
          "structure": {
            "backgroundColor": "String",
            "textColor": "String",
            "accentColor": "String",
            "template": "String (default, announcement, promotion, alert)"
          }
        },
        "interactions": {
          "type": "Object",
          "structure": {
            "allowComments": "Boolean",
            "requireAcknowledgment": "Boolean",
            "callToAction": "Object (text, url, tracking)"
          }
        },
        "analytics": {
          "type": "Object",
          "structure": {
            "views": "Number",
            "clicks": "Number",
            "acknowledgments": "Number",
            "shares": "Number",
            "engagementRate": "Number",
            "lastViewed": "Date"
          }
        },
        "visibility": {
          "type": "Object",
          "structure": {
            "showOnDashboard": "Boolean",
            "showInNotifications": "Boolean",
            "pinned": "Boolean",
            "featured": "Boolean"
          }
        },
        "author": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "tags": {
          "type": "Array<String>"
        },
        "version": {
          "type": "Number",
          "default": 1
        },
        "lastModified": {
          "type": "Date",
          "default": "Date.now"
        }
      }
    },
    "AchievementBadge": {
      "collectionName": "achievementbadges",
      "description": "Gamification badges to reward user accomplishments (staking, ranks, team building, earnings)",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "auto": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "badgeType": {
          "type": "String",
          "enum": ["first_stake", "stake_100", "stake_500", "stake_1000", "stake_5000", "stake_10000", "rank_associate_stakeholder", "rank_principal_strategist", "rank_elite_capitalist", "rank_wealth_architect", "rank_finance_titan", "team_builder_5", "team_builder_10", "team_builder_25", "team_builder_50", "team_builder_100", "profit_starter", "profit_maker", "profit_master", "profit_champion", "profit_legend", "referral_champion", "referral_master", "referral_legend", "early_adopter", "consistent_staker", "team_motivator", "network_builder", "empire_creator"],
          "required": true
        },
        "title": {
          "type": "String",
          "required": true
        },
        "description": {
          "type": "String",
          "required": true
        },
        "icon": {
          "type": "String",
          "required": true,
          "default": ""
        },
        "rarity": {
          "type": "String",
          "enum": ["common", "rare", "epic", "legendary"],
          "required": true
        },
        "awardedAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "progress": {
          "type": "Object",
          "structure": {
            "current": "Number",
            "required": "Number",
            "percentage": "Number"
          }
        },
        "metadata": {
          "type": "Mixed",
          "description": "Badge-specific data (stakingAmount, teamSize, earnings, rank, etc.)"
        },
        "isDisplayed": {
          "type": "Boolean",
          "default": true,
          "description": "User can choose to display or hide badges"
        }
      },
      "badgeCategories": {
        "staking": "first_stake, stake_100 to stake_10000",
        "ranks": "rank_associate_stakeholder to rank_finance_titan",
        "teamBuilding": "team_builder_5 to team_builder_100",
        "earnings": "profit_starter to profit_legend",
        "referrals": "referral_champion to referral_legend",
        "special": "early_adopter, consistent_staker, team_motivator, network_builder, empire_creator"
      }
    },
    "ActivityFeed": {
      "collectionName": "activityfeeds",
      "description": "User activity feed with real-time platform actions, milestones, and simulated activities for engagement",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "user": { "type": "ObjectId", "ref": "User", "required": true, "description": "User who owns this activity" },
        "type": { "type": "String", "enum": ["user_action", "system_event", "simulated_action", "milestone", "achievement"], "required": true },
        "category": { "type": "String", "enum": ["staking", "withdrawal", "referral", "goal", "system", "social", "security"], "required": true },
        "action": { "type": "String", "required": true, "maxLength": 100, "description": "Action name (e.g., 'stake_created')" },
        "description": { "type": "String", "required": true, "maxLength": 500, "description": "Human-readable description" },
        "entityType": { "type": "String", "enum": ["stake", "transaction", "goal", "user", "bonus", "notification"], "description": "Related entity type" },
        "entityId": { "type": "ObjectId", "description": "Related entity ID" },
        "metadata": { 
          "type": "Object", 
          "description": "Additional data",
          "fields": {
            "amount": "Number",
            "currency": "String (default: USDT)",
            "fromUser": "ObjectId (User)",
            "toUser": "ObjectId (User)",
            "goalTitle": "String",
            "milestone": "Number",
            "referralLevel": "Number"
          }
        },
        "visibility": {
          "type": "Object",
          "fields": {
            "public": "Boolean (show in public feed)",
            "showToUser": "Boolean (show to owner)",
            "showInFeed": "Boolean (show in activity feed)",
            "showInNotifications": "Boolean (send notification)"
          }
        },
        "priority": { "type": "String", "enum": ["low", "medium", "high", "urgent"], "description": "Activity priority" },
        "isSimulated": { "type": "Boolean", "default": false, "description": "Whether this is a simulated activity for engagement" },
        "simulationSettings": {
          "type": "Object",
          "fields": {
            "generatedBy": "String",
            "template": "String",
            "randomSeed": "Number"
          }
        },
        "analytics": {
          "type": "Object",
          "fields": {
            "views": "Number (default: 0)",
            "clicks": "Number (default: 0)",
            "interactions": "Number (default: 0)",
            "lastViewed": "Date"
          }
        },
        "formatting": {
          "type": "Object",
          "fields": {
            "icon": "String (emoji or icon name)",
            "color": "String (hex color)",
            "badge": "String (badge text)",
            "highlight": "Boolean (emphasize this activity)"
          }
        },
        "grouping": {
          "type": "Object",
          "fields": {
            "sessionId": "String",
            "groupKey": "String",
            "canGroup": "Boolean"
          }
        },
        "isRead": { "type": "Boolean", "default": false },
        "expiresAt": { "type": "Date", "description": "Auto-delete after this date" },
        "createdAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["user", "type", "category", "createdAt"],
      "frontendUsage": "Powers activity feed showing recent platform actions and user achievements"
    },
    "AdminActivityLog": {
      "collectionName": "adminactivitylogs",
      "description": "Audit trail of all admin actions for compliance and security monitoring",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "admin": { "type": "ObjectId", "ref": "User", "required": true, "description": "Admin who performed action" },
        "action": { "type": "String", "required": true, "description": "Action performed (e.g., 'user_banned', 'withdrawal_approved')" },
        "target": { "type": "ObjectId", "ref": "User", "description": "User affected by action" },
        "metadata": { "type": "Object", "description": "Additional action details (amounts, reasons, etc.)" },
        "createdAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["admin", "target", "createdAt"],
      "frontendUsage": "Super admin dashboard to view admin activity history"
    },
    "AdminAnalytics": {
      "collectionName": "adminanalytics",
      "description": "Pre-computed analytics and insights for admin dashboard with charts, metrics, and recommendations",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "analyticsId": { "type": "String", "unique": true, "description": "Unique identifier for this analytics record" },
        "type": { "type": "String", "enum": ["financial", "user_activity", "system_performance", "business_metrics", "security", "compliance"], "required": true },
        "category": { "type": "String", "description": "Sub-category of analytics" },
        "title": { "type": "String", "required": true },
        "description": { "type": "String" },
        "timeframe": {
          "type": "Object",
          "fields": {
            "period": "String (1h, 24h, 7d, 30d, 90d, 1y, custom)",
            "startDate": "Date",
            "endDate": "Date",
            "timezone": "String"
          }
        },
        "metrics": {
          "type": "Object",
          "description": "Primary and secondary metrics",
          "fields": {
            "primary": {
              "name": "String",
              "value": "Number",
              "unit": "String",
              "trend": "String (up, down, stable)",
              "trendPercentage": "Number",
              "targetValue": "Number",
              "threshold": {
                "warning": "Number",
                "critical": "Number"
              }
            },
            "secondary": "Array of metrics"
          }
        },
        "data": {
          "type": "Object",
          "description": "Chart data",
          "fields": {
            "labels": "Array<String> (x-axis labels)",
            "datasets": "Array<Object> (chart datasets with type: line/bar/pie/doughnut/scatter)"
          }
        },
        "insights": {
          "type": "Object",
          "fields": {
            "summary": "String",
            "keyFindings": "Array<String>",
            "recommendations": "Array<String>",
            "alerts": "Array<Object> (level: info/warning/critical)",
            "comparisons": "Array<Object> (period-over-period comparisons)"
          }
        },
        "filters": {
          "type": "Object",
          "fields": {
            "applied": "Array (currently applied filters)",
            "available": "Array<Object> (available filter options)"
          }
        },
        "visualization": {
          "type": "Object",
          "fields": {
            "chartType": "String (line, bar, pie, table, card, gauge)",
            "config": "Object (chart configuration)",
            "responsive": "Boolean",
            "showLegend": "Boolean",
            "showTooltips": "Boolean",
            "animations": "Boolean"
          }
        },
        "permissions": {
          "type": "Object",
          "fields": {
            "viewRoles": "Array<String> (roles that can view)",
            "editRoles": "Array<String> (roles that can edit)",
            "exportRoles": "Array<String> (roles that can export)",
            "shareRoles": "Array<String> (roles that can share)"
          }
        },
        "automation": {
          "type": "Object",
          "fields": {
            "autoUpdate": "Boolean",
            "updateFrequency": "String (5m, 15m, 1h, 6h, 24h)",
            "lastUpdated": "Date",
            "nextUpdate": "Date",
            "dataSource": "String",
            "calculations": "Array (calculation formulas)"
          }
        },
        "isActive": { "type": "Boolean", "default": true },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "frontendUsage": "Powers admin dashboard analytics with real-time insights and visualizations"
    },
    "AdminApprovalWorkflow": {
      "collectionName": "adminapprovalworkflows",
      "description": "Multi-admin approval workflow for sensitive operations requiring consensus",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "requesterId": { "type": "ObjectId", "ref": "User", "required": true, "description": "Admin who initiated request" },
        "actionType": { "type": "String", "required": true, "description": "Type of action (e.g., 'system_setting_change', 'user_ban')" },
        "requestData": { "type": "Mixed", "required": true, "description": "Data for the requested action" },
        "approvers": {
          "type": "Array<Object>",
          "description": "Array of approver statuses",
          "structure": {
            "approverId": "ObjectId (User)",
            "status": "String (pending, approved, rejected)",
            "comments": "String",
            "timestamp": "Date"
          }
        },
        "status": { "type": "String", "enum": ["pending", "approved", "rejected"], "default": "pending" },
        "approvalCriteria": {
          "type": "Object",
          "fields": {
            "requiredApprovals": "Number (min: 1) - How many approvals needed",
            "expiryHours": "Number (default: 24) - Hours until expiry"
          }
        },
        "metadata": { "type": "Mixed", "description": "Additional metadata" },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "completedAt": { "type": "Date", "description": "When workflow completed" },
        "expiresAt": { "type": "Date", "required": true, "description": "Workflow expiry date" }
      },
      "indexes": ["requesterId", "status", "expiresAt"],
      "frontendUsage": "Admin approval queue showing pending requests requiring multi-admin consensus"
    },
    "AdminTooltip": {
      "collectionName": "admintooltips",
      "description": "Contextual help tooltips and documentation for admin dashboard features",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "key": { "type": "String", "required": true, "unique": true, "description": "Unique key for tooltip" },
        "title": { "type": "String", "required": true, "maxLength": 200 },
        "content": { "type": "String", "required": true },
        "description": { "type": "String" },
        "category": { "type": "String", "enum": ["setting", "feature", "action", "metric", "workflow", "control"], "required": true },
        "targetElement": { "type": "String", "description": "CSS selector for element to attach tooltip" },
        "position": { "type": "String", "enum": ["top", "bottom", "left", "right", "auto"], "default": "auto" },
        "triggerType": { "type": "String", "enum": ["hover", "click", "focus", "manual"], "default": "hover" },
        "visibility": {
          "type": "Object",
          "fields": {
            "adminLevel": "String (all, super_admin, admin, moderator)",
            "showForNewAdmins": "Boolean",
            "showInContext": "Boolean",
            "alwaysVisible": "Boolean"
          }
        },
        "content_details": {
          "type": "Object",
          "fields": {
            "shortDescription": "String",
            "detailedExplanation": "String",
            "examples": "Array<String>",
            "warnings": "Array<String>",
            "bestPractices": "Array<String>",
            "relatedSettings": "Array<String>",
            "businessImpact": "String",
            "technicalNotes": "String"
          }
        },
        "interactivity": {
          "type": "Object",
          "fields": {
            "hasActions": "Boolean",
            "actionButtons": "Array<Object> (label, action, url, confirmationRequired)",
            "hasVideo": "Boolean",
            "videoUrl": "String",
            "hasDocumentation": "Boolean",
            "documentationUrl": "String"
          }
        },
        "styling": {
          "type": "Object",
          "fields": {
            "maxWidth": "Number",
            "backgroundColor": "String",
            "textColor": "String",
            "borderColor": "String",
            "fontSize": "String",
            "icon": "String",
            "theme": "String (default, warning, success, info, danger)"
          }
        },
        "conditions": {
          "type": "Object",
          "fields": {
            "showWhen": "Array",
            "hideWhen": "Array",
            "userRoles": "Array<String>",
            "permissions": "Array<String>",
            "contextRequired": "Array<String>"
          }
        },
        "analytics": {
          "type": "Object",
          "fields": {
            "views": "Number (default: 0)",
            "interactions": "Number (default: 0)",
            "helpfulVotes": "Number (default: 0)",
            "unhelpfulVotes": "Number (default: 0)",
            "lastViewed": "Date",
            "averageViewTime": "Number"
          }
        },
        "isActive": { "type": "Boolean", "default": true },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "frontendUsage": "Contextual help system for admin dashboard explaining features and settings"
    },
    "BiometricDevice": {
      "collectionName": "biometricdevices",
      "description": "WebAuthn biometric device registration for passwordless authentication (fingerprint, Face ID)",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "userId": { "type": "ObjectId", "ref": "User", "required": true, "indexed": true },
        "credentialId": { "type": "String", "required": true, "unique": true, "indexed": true, "description": "WebAuthn credential ID" },
        "publicKey": { "type": "String", "required": true, "description": "Public key for verification" },
        "counter": { "type": "Number", "required": true, "default": 0, "description": "Signature counter to prevent replay attacks" },
        "deviceInfo": {
          "type": "Object",
          "fields": {
            "userAgent": "String (required)",
            "platform": "String (required)",
            "authenticatorType": "String (platform, cross-platform) - required",
            "deviceName": "String",
            "browserVersion": "String",
            "operatingSystem": "String"
          }
        },
        "backupPin": { "type": "String", "description": "Hashed backup PIN" },
        "isActive": { "type": "Boolean", "default": true, "indexed": true },
        "registeredAt": { "type": "Date", "default": "Date.now" },
        "lastUsed": { "type": "Date" },
        "deactivatedAt": { "type": "Date" },
        "failedAttempts": { "type": "Number", "default": 0 },
        "requiresDeviceRegistration": { "type": "Boolean", "default": false },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["userId", "credentialId", "isActive"],
      "frontendUsage": "Biometric login options (fingerprint, Face ID) for enhanced security"
    },
    "BonusHistory": {
      "collectionName": "bonushistories",
      "description": "Historical record of all bonuses earned by users across different bonus types",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "user": { "type": "ObjectId", "ref": "User", "required": true },
        "amount": { "type": "Number", "required": true, "description": "Bonus amount in USDT" },
        "bonusType": { "type": "String", "required": true, "enum": ["Deposit Bonus", "Referral Bonus", "Stake Bonus", "Level Bonus", "Finance Titan Pool", "Level 2 Restake"] },
        "source": { "type": "String", "required": true, "description": "Source of bonus (e.g., 'Finance Titan Pool', 'Level 2 Restake')" },
        "createdAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["user", "bonusType", "createdAt"],
      "frontendUsage": "User bonus history showing all bonuses earned over time"
    },
    "BusinessRule": {
      "collectionName": "businessrules",
      "description": "Dynamic business rules engine for configurable limits, thresholds, and fraud detection settings",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "ruleId": { "type": "String", "required": true, "unique": true, "description": "Unique rule identifier" },
        "name": { "type": "String", "required": true, "description": "Human-readable rule name" },
        "category": { "type": "String", "enum": ["limits", "fraud", "financial", "operational", "security"], "required": true },
        "type": { "type": "String", "enum": ["threshold", "boolean", "percentage", "amount", "count", "time"], "required": true },
        "isActive": { "type": "Boolean", "default": true },
        "priority": { "type": "Number", "default": 1, "description": "Execution priority (1 = highest)" },
        "parameters": {
          "type": "Object",
          "fields": {
            "key": "String (parameter key, e.g., 'max_daily_withdrawal')",
            "value": "Any (parameter value)",
            "dataType": "String (number, boolean, string, array, object)",
            "unit": "String (USDT, %, count, minutes)",
            "minValue": "Number",
            "maxValue": "Number",
            "allowedValues": "Array",
            "validationPattern": "String (regex)"
          }
        },
        "conditions": {
          "type": "Object",
          "fields": {
            "userLevel": "Array<String>",
            "accountAge": "Number (min account age in days)",
            "kycStatus": "Boolean",
            "timeOfDay": { "startHour": "Number", "endHour": "Number", "timezone": "String" },
            "dayOfWeek": "Array<Number> (0 = Sunday)"
          }
        },
        "actions": {
          "type": "Object",
          "fields": {
            "block": "Boolean (block the operation)",
            "blockMessage": "String",
            "requireApproval": "Boolean",
            "approvalMessage": "String",
            "notify": "Boolean",
            "logSecurity": "Boolean",
            "escalate": "Boolean"
          }
        },
        "metrics": {
          "type": "Object",
          "fields": {
            "triggeredCount": "Number (default: 0)",
            "lastTriggered": "Date",
            "falsePositiveCount": "Number (default: 0)",
            "effectivenessScore": "Number (0-100)"
          }
        },
        "createdBy": { "type": "ObjectId", "ref": "User" },
        "lastModifiedBy": { "type": "ObjectId", "ref": "User" },
        "modificationReason": { "type": "String" },
        "description": { "type": "String", "required": true },
        "businessJustification": { "type": "String", "required": true },
        "riskLevel": { "type": "String", "enum": ["low", "medium", "high", "critical"], "required": true },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["ruleId", "category", "isActive", "priority"],
      "frontendUsage": "Admin dashboard for managing dynamic business rules and limits"
    },
    "ChatConversation": {
      "collectionName": "chatconversations",
      "description": "AI chatbot conversation history with sentiment analysis and support escalation",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "userId": { "type": "ObjectId", "ref": "User", "description": "User (null for anonymous)" },
        "sessionId": { "type": "String", "required": true, "indexed": true, "description": "Session ID for anonymous users" },
        "telegramChatId": { "type": "Number", "description": "Telegram integration chat ID" },
        "messages": {
          "type": "Array<Object>",
          "structure": {
            "role": "String (user, assistant, system)",
            "content": "String (message content)",
            "timestamp": "Date"
          }
        },
        "sentiment": { "type": "String", "enum": ["positive", "neutral", "negative"], "default": "neutral" },
        "resolved": { "type": "Boolean", "default": false },
        "needsHumanSupport": { "type": "Boolean", "default": false, "description": "Escalate to human support" },
        "tags": { "type": "Array<String>", "default": [], "description": "Topics (staking, withdrawal, technical)" },
        "isActive": { "type": "Boolean", "default": true },
        "lastMessageAt": { "type": "Date", "default": "Date.now" },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["userId", "sessionId", "telegramChatId", "isActive", "needsHumanSupport"],
      "autoDelete": "Old conversations auto-deleted after 30 days",
      "frontendUsage": "AI chatbot interface with conversation history and support escalation"
    },
    "ContextualText": {
      "collectionName": "contextualtexts",
      "description": "Dynamic contextual messages and tooltips shown throughout the platform based on user context",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "key": { "type": "String", "required": true, "unique": true, "maxLength": 100 },
        "title": { "type": "String", "required": true, "maxLength": 200 },
        "content": { "type": "String", "required": true, "maxLength": 1000 },
        "type": { "type": "String", "enum": ["info", "warning", "success", "tip", "alert"], "required": true },
        "location": { "type": "String", "enum": ["dashboard", "staking", "wallet", "profile", "global", "withdrawal", "referral"], "required": true },
        "priority": { "type": "Number", "default": 1, "min": 1 },
        "conditions": {
          "type": "Object",
          "fields": {
            "userRole": "Array<String>",
            "minStakeAmount": "Number",
            "userStatus": "Array<String>",
            "timeOfDay": "Array<String>",
            "customRules": "Any"
          }
        },
        "styling": {
          "type": "Object",
          "fields": {
            "backgroundColor": "String",
            "textColor": "String",
            "borderColor": "String",
            "icon": "String",
            "animation": "Boolean"
          }
        },
        "interactions": {
          "type": "Object",
          "fields": {
            "dismissible": "Boolean",
            "actionButton": { "text": "String", "url": "String", "action": "String" },
            "showFrequency": "String (always, once_per_session, once_per_day, once_per_week)"
          }
        },
        "analytics": {
          "type": "Object",
          "fields": {
            "impressions": "Number (default: 0)",
            "clicks": "Number (default: 0)",
            "dismissals": "Number (default: 0)",
            "conversions": "Number (default: 0)",
            "lastShown": "Date"
          }
        },
        "isActive": { "type": "Boolean", "default": true },
        "validFrom": { "type": "Date" },
        "validTo": { "type": "Date" },
        "createdBy": { "type": "ObjectId", "ref": "User" },
        "lastModified": { "type": "Date", "default": "Date.now" },
        "version": { "type": "Number", "default": 1 }
      },
      "indexes": ["key", "location", "isActive", "validFrom", "validTo"],
      "frontendUsage": "Dynamic contextual messages shown based on user context and location in app"
    },
    "PlatformActivity": {
      "collectionName": "platformactivities",
      "description": "Public activity feed showing real-time and simulated platform actions for social proof and engagement",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "type": { "type": "String", "enum": ["stake", "withdrawal", "maturity_reached", "referral_bonus", "registration_bonus", "new_signup", "milestone"], "required": true, "indexed": true },
        "userId": { "type": "ObjectId", "ref": "User", "description": "User (null for simulated activities)" },
        "isSimulated": { "type": "Boolean", "required": true, "default": false, "indexed": true },
        "maskedUsername": { "type": "String", "required": true, "description": "Masked username (e.g., 'J*n', 'M**a')" },
        "country": { "type": "String", "required": true },
        "countryCode": { "type": "String", "required": true, "length": 2, "uppercase": true },
        "flagEmoji": { "type": "String", "required": true, "description": "Country flag emoji" },
        "amount": { "type": "Number", "min": 0, "description": "Amount in USDT (if applicable)" },
        "description": { "type": "String", "required": true, "description": "Activity description" },
        "emoji": { "type": "String", "required": true, "description": "Activity emoji (, , )" },
        "isHot": { "type": "Boolean", "default": false, "description": "Highlight as trending" },
        "priority": { "type": "Number", "default": 1, "description": "Higher priority shows first" },
        "activityDate": { "type": "Date", "required": true },
        "expiresAt": { "type": "Date", "description": "Auto-delete old activities" },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "updatedAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["type", "isSimulated", "activityDate", "expiresAt"],
      "methods": ["getTimeAgo()"],
      "frontendUsage": "Public activity feed showing recent platform actions for social proof"
    },
    "SocialClickToken": {
      "collectionName": "socialclicktokens",
      "description": "Tokens for tracking social media platform visits required for registration bonus verification",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "token": { "type": "String", "required": true, "unique": true, "description": "Unique verification token" },
        "userId": { "type": "ObjectId", "ref": "User", "required": true },
        "platform": { "type": "String", "required": true, "description": "Social platform (youtube, facebook, tiktok, instagram, telegram)" },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "expiresAt": { "type": "Date", "description": "Token expiry" },
        "used": { "type": "Boolean", "default": false },
        "usedAt": { "type": "Date" }
      },
      "indexes": ["token", "userId", "platform"],
      "frontendUsage": "Registration bonus social media verification tracking"
    },
    "SpecialFundsContract": {
      "collectionName": "specialfundscontracts",
      "description": "Special funds contracts for high-value users with custom staking terms and compounding options",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "userId": { "type": "ObjectId", "ref": "User", "required": true },
        "contractId": { "type": "String", "required": true, "unique": true },
        "status": { "type": "String", "enum": ["pending_approval", "active", "terminated", "completed"], "default": "pending_approval" },
        "contractType": { "type": "String", "default": "special_funds" },
        "principalAmount": { "type": "Number", "required": true, "min": 0 },
        "currentStakeAmount": { "type": "Number", "default": 0 },
        "totalEarnings": { "type": "Number", "default": 0 },
        "totalWithdrawn": { "type": "Number", "default": 0 },
        "stakingDurationDays": { "type": "Number", "required": true },
        "stakingPercentage": { "type": "Number", "required": true, "description": "Uses platform default rate" },
        "maxContractLimit": { "type": "Number", "required": true },
        "createdAt": { "type": "Date", "default": "Date.now" },
        "startDate": { "type": "Date" },
        "endDate": { "type": "Date" },
        "lastEarningsCalculation": { "type": "Date" },
        "targetTradingVolume": { "type": "Number", "default": 0 },
        "currentTradingVolume": { "type": "Number", "default": 0 },
        "targetMet": { "type": "Boolean", "default": false },
        "targetDeadline": { "type": "Date" },
        "isCompounding": { "type": "Boolean", "default": false },
        "compoundingApprovalRequired": { "type": "Boolean", "default": true },
        "compoundingApprovedBy": { "type": "ObjectId", "ref": "User" },
        "compoundingApprovedAt": { "type": "Date" },
        "createdBy": { "type": "ObjectId", "ref": "User", "required": true },
        "approvedBy": { "type": "ObjectId", "ref": "User" },
        "approvedAt": { "type": "Date" },
        "terminatedBy": { "type": "ObjectId", "ref": "User" },
        "terminatedAt": { "type": "Date" },
        "terminationReason": { "type": "String" },
        "contractHistory": {
          "type": "Array<Object>",
          "structure": {
            "action": "String (created, approved, amount_added, earnings_calculated, withdrawal, compounding_enabled, compounding_disabled, terminated, duration_extended)",
            "amount": "Number",
            "previousAmount": "Number",
            "newAmount": "Number",
            "performedBy": "ObjectId (User)",
            "performedAt": "Date",
            "reason": "String",
            "metadata": "Any"
          }
        },
        "notes": { "type": "String" },
        "tags": { "type": "Array<String>" }
      },
      "indexes": ["userId", "contractId", "status"],
      "methods": ["addToHistory()", "calculateEarnings()", "isExpired()", "getDaysRemaining()"],
      "frontendUsage": "Special contract management for VIP users with custom terms"
    },
    "UniqueTransactionId": {
      "collectionName": "uniquetransactionids",
      "description": "Unique transaction identifiers with idempotency protection and blockchain tracking for all financial operations",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "uniqueId": { "type": "String", "required": true, "unique": true, "indexed": true, "description": "Internal UUID" },
        "type": { "type": "String", "enum": ["deposit", "withdrawal", "transfer", "stake", "bonus", "nowpayments_invoice"], "required": true, "indexed": true },
        "nowPaymentsInvoiceId": { "type": "String", "unique": true, "sparse": true, "indexed": true },
        "nowPaymentsPaymentId": { "type": "String", "unique": true, "sparse": true },
        "nowPaymentsTxId": { "type": "String", "description": "Blockchain transaction ID from NowPayments" },
        "blockchainNetwork": { "type": "String", "description": "BEP20, TRC20, etc." },
        "blockchainTxHash": { "type": "String", "description": "Actual blockchain transaction hash" },
        "blockConfirmations": { "type": "Number", "description": "Number of confirmations" },
        "userId": { "type": "ObjectId", "ref": "User" },
        "amount": { "type": "Number" },
        "currency": { "type": "String" },
        "status": { "type": "String", "enum": ["pending", "processing", "confirmed", "failed", "expired"], "default": "pending" },
        "isProcessed": { "type": "Boolean", "default": false },
        "isIdempotent": { "type": "Boolean", "default": true },
        "requestFingerprint": { "type": "String", "description": "Hash of request parameters" },
        "clientRequestId": { "type": "String", "description": "Client-provided request ID" },
        "createdBy": { "type": "ObjectId", "ref": "User" },
        "ipAddress": { "type": "String" },
        "userAgent": { "type": "String" },
        "webhookReceived": { "type": "Boolean", "default": false },
        "webhookProcessed": { "type": "Boolean", "default": false },
        "webhookAttempts": { "type": "Number", "default": 0 },
        "lastWebhookAt": { "type": "Date" },
        "expiresAt": { "type": "Date", "description": "ID expiry date" },
        "processedAt": { "type": "Date" },
        "confirmedAt": { "type": "Date" },
        "createdAt": { "type": "Date", "default": "Date.now" }
      },
      "indexes": ["uniqueId", "type", "nowPaymentsInvoiceId", "status", "userId", "createdAt"],
      "ttlIndex": { "field": "createdAt", "expireAfterSeconds": "30 days" },
      "methods": ["updateWebhookStatus()"],
      "frontendUsage": "Transaction tracking and idempotency protection (internal, not directly exposed)"
    },
    "SpecialFundsSettings": {
      "collectionName": "specialfundssettings",
      "description": "Platform-wide admin settings for special funds contracts (singleton document)",
      "fields": {
        "_id": { "type": "ObjectId", "required": true, "auto": true },
        "maxContractAmountPerUser": { "type": "Number", "default": 10000, "min": 0, "description": "Maximum contract amount per user ($10,000 default)" },
        "maxActiveContractsGlobal": { "type": "Number", "default": 100, "min": 1, "description": "Maximum active contracts platform-wide" },
        "minContractAmount": { "type": "Number", "default": 100, "min": 1, "description": "Minimum contract amount ($100 default)" },
        "maxContractDurationDays": { "type": "Number", "default": 365, "min": 1, "description": "Maximum contract duration (1 year default)" },
        "minContractDurationDays": { "type": "Number", "default": 30, "min": 1, "description": "Minimum contract duration (30 days default)" },
        "defaultStakingPercentage": { "type": "Number", "default": 12, "min": 0, "max": 100, "description": "Default staking APY (12% default)" },
        "defaultTargetTradingVolumeMultiplier": { "type": "Number", "default": 2, "min": 1, "description": "Default trading volume multiplier (2x contract amount)" },
        "requireApprovalForAmountsAbove": { "type": "Number", "default": 1000, "min": 0, "description": "Require approval for amounts above ($1,000 default)" },
        "autoApprovalEnabled": { "type": "Boolean", "default": false, "description": "Enable automatic contract approvals" },
        "specialFundsEnabled": { "type": "Boolean", "default": true, "description": "Enable special funds feature platform-wide" },
        "allowCompounding": { "type": "Boolean", "default": true, "description": "Allow earnings compounding" },
        "maxCompoundingCycles": { "type": "Number", "default": 5, "min": 0, "description": "Maximum compounding cycles allowed" },
        "minWithdrawalAmount": { "type": "Number", "default": 10, "min": 0, "description": "Minimum withdrawal amount ($10 default)" },
        "withdrawalFeePercentage": { "type": "Number", "default": 0, "min": 0, "max": 10, "description": "Withdrawal fee percentage (0% default)" },
        "lastUpdatedBy": { "type": "ObjectId", "ref": "User", "description": "Admin who last updated settings" },
        "lastUpdatedAt": { "type": "Date", "default": "Date.now" }
      },
      "uniqueIndex": "Only one settings document allowed (singleton pattern)",
      "frontendUsage": "Admin settings panel for configuring special funds platform limits and defaults"
    }
  },
  "relationships": {
    "User_UserWallet": {
      "type": "one-to-one",
      "from": "User._id",
      "to": "UserWallet.userId",
      "description": "Each user has exactly one wallet"
    },
    "User_Transaction": {
      "type": "one-to-many",
      "from": "User._id",
      "to": "Transaction.user",
      "description": "User can have multiple transactions"
    },
    "User_Stake": {
      "type": "one-to-many",
      "from": "User._id",
      "to": "Stake.userId",
      "description": "User can have multiple stakes"
    },
    "User_Referral": {
      "type": "self-referential",
      "from": "User._id",
      "to": "User.referrer",
      "description": "Users can refer other users"
    },
    "User_Downlines": {
      "type": "one-to-many",
      "from": "User._id",
      "to": "User.directDownlines[]",
      "description": "User has array of directly referred users"
    },
    "RegistrationBonus_Stake": {
      "type": "one-to-one",
      "from": "RegistrationBonus.bonusStakeId",
      "to": "Stake._id",
      "description": "Registration bonus creates one bonus stake"
    },
    "WeeklyProfit_User": {
      "type": "many-to-one",
      "from": "WeeklyProfit.distributedBy",
      "to": "User._id",
      "description": "Admin who distributed profits"
    }
  }
}
