{
  "schemas": {
    "User": {
      "modelName": "User",
      "collectionName": "users",
      "description": "Main user account model with authentication, profile data, rank system, and referral tracking",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "description": "Unique user identifier"
        },
        "fname": {
          "type": "String",
          "required": true,
          "description": "User's first name"
        },
        "lname": {
          "type": "String",
          "required": true,
          "description": "User's last name"
        },
        "username": {
          "type": "String",
          "required": true,
          "unique": true,
          "trim": true,
          "lowercase": true,
          "description": "Unique username for login"
        },
        "email": {
          "type": "String",
          "required": true,
          "unique": true,
          "lowercase": true,
          "trim": true,
          "validation": "Email format validation (RFC 5322)",
          "description": "User's email address"
        },
        "password": {
          "type": "String",
          "required": true,
          "minlength": 8,
          "select": false,
          "description": "Hashed password using BetterAuth bcrypt",
          "validation": "Min 8 chars, 1 uppercase, 1 lowercase, 1 digit, 1 special char"
        },
        "profilePicture": {
          "type": "String",
          "required": false,
          "description": "URL to user's profile picture"
        },
        "twoFAEnabled": {
          "type": "Boolean",
          "default": false,
          "description": "Whether 2FA is enabled"
        },
        "twoFASecret": {
          "type": "String",
          "required": false,
          "description": "Google Authenticator secret for TOTP 2FA"
        },
        "role": {
          "type": "String",
          "enum": ["admin", "superAdmin", "user"],
          "default": "user",
          "description": "User's role for access control"
        },
        "referrer": {
          "type": "ObjectId",
          "ref": "User",
          "required": false,
          "description": "ID of user who referred this user"
        },
        "referralCode": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "description": "User's unique referral code for inviting others"
        },
        "referralBonusBalance": {
          "type": "Number",
          "default": 0,
          "description": "Deprecated: Total referral bonus balance (legacy field)"
        },
        "referralDepletionStartDate": {
          "type": "Date",
          "required": false,
          "description": "Date when referral depletion started"
        },
        "referralDepletionWarningDate": {
          "type": "Date",
          "required": false,
          "description": "Date when depletion warning was sent"
        },
        "isReferralEarningsStopped": {
          "type": "Boolean",
          "default": false,
          "description": "Whether referral earnings are stopped"
        },
        "hasQualifyingStake": {
          "type": "Boolean",
          "default": false,
          "description": "Whether user has created a qualifying stake"
        },
        "fcmTokens": {
          "type": "Array<String>",
          "default": [],
          "description": "Firebase Cloud Messaging tokens for push notifications"
        },
        "phoneNumber": {
          "type": "String",
          "sparse": true,
          "description": "User's phone number"
        },
        "countryCode": {
          "type": "String",
          "sparse": true,
          "description": "Country code for phone number"
        },
        "telegramChatId": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "description": "Telegram chat ID for Telegram bot integration"
        },
        "emailVerified": {
          "type": "Boolean",
          "default": false,
          "required": true,
          "description": "Whether email has been verified"
        },
        "emailVerificationCode": {
          "type": "String",
          "select": false,
          "description": "Code for email verification"
        },
        "emailVerificationExpires": {
          "type": "Date",
          "select": false,
          "description": "Expiration time for verification code"
        },
        "rank": {
          "type": "String",
          "enum": ["Stakeholder", "Associate Stakeholder", "Principal Strategist", "Elite Capitalist", "Wealth Architect", "Finance Titan"],
          "default": "Stakeholder",
          "description": "User's current rank in the system"
        },
        "directDownlines": {
          "type": "Array<ObjectId>",
          "ref": "User",
          "default": [],
          "description": "Array of user IDs directly referred by this user"
        },
        "teamStake": {
          "type": "Number",
          "default": 0,
          "description": "Total stake amount of entire team (all downlines)"
        },
        "personalStake": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "User's personal total stake amount"
        },
        "rankQualificationStatus": {
          "type": "String",
          "enum": ["qualified", "not_qualified", "pending_verification"],
          "default": "not_qualified",
          "description": "Current qualification status for rank"
        },
        "lastRankVerification": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last time rank was verified"
        },
        "rankPoolQualified": {
          "type": "Boolean",
          "default": false,
          "description": "Whether user qualifies for rank pool (Blue Tick)"
        },
        "redistributionPoolQualified": {
          "type": "Boolean",
          "default": false,
          "description": "Whether user qualifies for redistribution pool (Green Tick)"
        },
        "isActive": {
          "type": "Boolean",
          "default": true,
          "description": "Whether user account is active"
        },
        "failedLoginAttempts": {
          "type": "Number",
          "default": 0,
          "description": "Number of consecutive failed login attempts"
        },
        "lockoutUntil": {
          "type": "Date",
          "default": null,
          "description": "Account lockout expiration (after 5 failed logins, locked for 15 min)"
        },
        "lastFailedLogin": {
          "type": "Date",
          "default": null,
          "description": "Timestamp of last failed login attempt"
        },
        "tokenVersion": {
          "type": "Number",
          "default": 0,
          "description": "Token version for invalidating all user's tokens"
        },
        "resetSecret": {
          "type": "String",
          "select": false,
          "description": "Secret for password reset"
        },
        "resetToken": {
          "type": "String",
          "select": false,
          "description": "Token for password reset"
        },
        "resetTokenExpiration": {
          "type": "Number",
          "select": false,
          "description": "Expiration timestamp for reset token"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now",
          "description": "Account creation timestamp"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last update timestamp"
        }
      },
      "relationships": {
        "referrer": {
          "type": "one-to-one",
          "model": "User",
          "description": "User who referred this user"
        },
        "directDownlines": {
          "type": "one-to-many",
          "model": "User",
          "description": "Users directly referred by this user"
        },
        "wallet": {
          "type": "one-to-one",
          "model": "UserWallet",
          "foreignKey": "userId",
          "description": "User's wallet for financial operations"
        },
        "profile": {
          "type": "one-to-one",
          "model": "UserProfile",
          "foreignKey": "userId",
          "description": "Extended user profile information"
        },
        "preferences": {
          "type": "one-to-one",
          "model": "UserPreferences",
          "foreignKey": "user",
          "description": "User's application preferences and settings"
        },
        "stakes": {
          "type": "one-to-many",
          "model": "Stake",
          "foreignKey": "userId",
          "description": "All stakes created by this user"
        },
        "goals": {
          "type": "one-to-many",
          "model": "Goal",
          "foreignKey": "user",
          "description": "All financial goals created by this user"
        },
        "transactions": {
          "type": "one-to-many",
          "model": "Transaction",
          "foreignKey": "user",
          "description": "All transactions by this user"
        },
        "notifications": {
          "type": "one-to-many",
          "model": "Notification",
          "foreignKey": "user",
          "description": "All notifications for this user"
        },
        "referralBonuses": {
          "type": "one-to-many",
          "model": "ReferralBonus",
          "foreignKey": "user",
          "description": "Referral bonuses earned by this user"
        },
        "registrationBonus": {
          "type": "one-to-one",
          "model": "RegistrationBonus",
          "foreignKey": "userId",
          "description": "Registration bonus record for this user"
        }
      },
      "methods": {
        "comparePassword": {
          "params": ["candidatePassword: string"],
          "returns": "Promise<boolean>",
          "description": "Compare provided password with hashed password using BetterAuth"
        },
        "isLocked": {
          "params": [],
          "returns": "boolean",
          "description": "Check if account is currently locked due to failed login attempts"
        },
        "incrementLoginAttempts": {
          "params": [],
          "returns": "Promise<number>",
          "description": "Increment failed login attempts, lock account after 5 failures"
        },
        "resetLoginAttempts": {
          "params": [],
          "returns": "Promise<void>",
          "description": "Reset failed login attempts to 0 after successful login"
        }
      },
      "hooks": {
        "pre-save": [
          "Hash password using BetterAuth if password is modified",
          "Validate password complexity requirements"
        ]
      },
      "indexes": [
        "email (unique)",
        "username (unique)",
        "referralCode (unique, sparse)",
        "telegramChatId (unique, sparse)"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439011",
        "fname": "John",
        "lname": "Doe",
        "username": "johndoe",
        "email": "john.doe@example.com",
        "password": "$2a$10$N9qo8uLOickgx2ZMRZoMye...",
        "profilePicture": "https://example.com/profiles/johndoe.jpg",
        "twoFAEnabled": false,
        "twoFASecret": null,
        "role": "user",
        "referrer": "507f1f77bcf86cd799439012",
        "referralCode": "JOHN123",
        "referralBonusBalance": 0,
        "hasQualifyingStake": true,
        "fcmTokens": ["fcm_token_1", "fcm_token_2"],
        "phoneNumber": "+1234567890",
        "countryCode": "+1",
        "emailVerified": true,
        "rank": "Associate Stakeholder",
        "directDownlines": ["507f1f77bcf86cd799439013", "507f1f77bcf86cd799439014"],
        "teamStake": 5000,
        "personalStake": 1500,
        "rankQualificationStatus": "qualified",
        "rankPoolQualified": true,
        "redistributionPoolQualified": false,
        "isActive": true,
        "failedLoginAttempts": 0,
        "tokenVersion": 1,
        "createdAt": "2024-01-15T10:30:00.000Z",
        "updatedAt": "2024-10-10T14:20:00.000Z"
      }
    },
    "UserWallet": {
      "modelName": "UserWallet",
      "collectionName": "userwallets",
      "description": "Two-wallet system for managing user funds. Funded Wallet for deposits (stake only), Earning Wallet for profits (stake + withdraw)",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "description": "Unique wallet identifier"
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true,
          "description": "User who owns this wallet"
        },
        "balance": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Legacy field: Total balance (deprecated, use fundedWallet + earningWallet)"
        },
        "currency": {
          "type": "String",
          "default": "USD",
          "description": "Currency for wallet (default USD, represents USDT)"
        },
        "walletAddress": {
          "type": "String",
          "sparse": true,
          "description": "Blockchain wallet address if applicable"
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "description": "Legacy reference to user (same as userId)"
        },
        "fundedWallet": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "required": true,
          "description": "Funded Wallet: Holds deposits and P2P transfers. Can ONLY be used for staking, NOT for withdrawals"
        },
        "earningWallet": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "required": true,
          "description": "Earning Wallet: Holds all platform earnings (Stake Pool, Performance Pool, Premium Pool, Bonuses, Referrals). Can be used for BOTH staking AND withdrawals"
        },
        "totalDeposited": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total amount deposited"
        },
        "totalWithdrawn": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total amount withdrawn"
        },
        "totalStaked": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total amount staked"
        },
        "totalStakeReturns": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total stake returns received"
        },
        "totalTransferSent": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total P2P transfers sent"
        },
        "totalTransferReceived": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "description": "Lifetime total P2P transfers received"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now",
          "description": "Wallet creation timestamp"
        },
        "lastUpdated": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last wallet update timestamp"
        }
      },
      "relationships": {
        "userId": {
          "type": "one-to-one",
          "model": "User",
          "description": "User who owns this wallet"
        }
      },
      "methods": {
        "getTotalBalance": {
          "params": [],
          "returns": "number",
          "description": "Get total available balance (fundedWallet + earningWallet)"
        },
        "getAvailableBalance": {
          "params": [],
          "returns": "number",
          "description": "Alias for getTotalBalance"
        },
        "canStake": {
          "params": ["amount: number = 20"],
          "returns": "boolean",
          "description": "Check if user has enough balance to stake (minimum 20 USDT)"
        },
        "canWithdraw": {
          "params": ["amount: number"],
          "returns": "boolean",
          "description": "Check if user has enough in earning wallet to withdraw"
        },
        "getWithdrawableAmount": {
          "params": [],
          "returns": "number",
          "description": "Get amount available for withdrawal (only earningWallet)"
        },
        "getStakableAmount": {
          "params": [],
          "returns": "number",
          "description": "Get amount available for staking (fundedWallet + earningWallet)"
        }
      },
      "hooks": [],
      "indexes": [
        "userId (unique)"
      ],
      "notes": [
        "TWO-WALLET SYSTEM (October 2, 2025):",
        "1. FUNDED WALLET: Deposits + P2P transfers → Can ONLY stake",
        "2. EARNING WALLET: All earnings → Can stake + withdraw",
        "Earnings go to: Earning Wallet",
        "Deposits go to: Funded Wallet",
        "Withdrawals from: Earning Wallet ONLY",
        "Staking from: Both wallets (fundedWallet + earningWallet)"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439021",
        "userId": "507f1f77bcf86cd799439011",
        "balance": 0,
        "currency": "USD",
        "walletAddress": null,
        "fundedWallet": 500,
        "earningWallet": 1250.75,
        "totalDeposited": 2000,
        "totalWithdrawn": 500,
        "totalStaked": 1500,
        "totalStakeReturns": 750.75,
        "totalTransferSent": 100,
        "totalTransferReceived": 50,
        "createdAt": "2024-01-15T10:30:00.000Z",
        "lastUpdated": "2024-10-10T14:20:00.000Z"
      }
    },
    "UserProfile": {
      "modelName": "UserProfile",
      "collectionName": "userprofiles",
      "description": "Extended user profile information for registration bonus eligibility, KYC, and fraud prevention",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true,
          "description": "Unique profile identifier"
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true,
          "description": "User this profile belongs to"
        },
        "firstName": {
          "type": "String",
          "trim": true,
          "maxlength": 50,
          "description": "User's first name"
        },
        "lastName": {
          "type": "String",
          "trim": true,
          "maxlength": 50,
          "description": "User's last name"
        },
        "fullName": {
          "type": "String",
          "trim": true,
          "maxlength": 100,
          "required": true,
          "description": "Full name (required for registration bonus)"
        },
        "username": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "minlength": 3,
          "maxlength": 30,
          "validation": "Letters, numbers, underscores only",
          "description": "Unique username"
        },
        "dateOfBirth": {
          "type": "Date",
          "validation": "Must be at least 18 years old",
          "description": "User's date of birth"
        },
        "gender": {
          "type": "String",
          "enum": ["male", "female", "other", "prefer_not_to_say"],
          "required": true,
          "description": "Gender (required for registration bonus)"
        },
        "profilePhoto": {
          "type": "String",
          "trim": true,
          "description": "URL to profile photo"
        },
        "bio": {
          "type": "String",
          "maxlength": 500,
          "description": "User biography"
        },
        "email": {
          "type": "String",
          "trim": true,
          "lowercase": true,
          "required": true,
          "validation": "Valid email format",
          "description": "Email (required for registration bonus)"
        },
        "phone": {
          "type": "String",
          "trim": true,
          "required": true,
          "validation": "E.164 international format (+1234567890)",
          "description": "Phone number (required for registration bonus, flagged if reused)"
        },
        "alternativePhone": {
          "type": "String",
          "trim": true,
          "description": "Alternative phone number"
        },
        "deviceFingerprint": {
          "type": "String",
          "required": true,
          "description": "Unique device fingerprint for fraud prevention"
        },
        "socialMediaHandle": {
          "type": "String",
          "trim": true,
          "required": true,
          "maxlength": 100,
          "description": "Facebook handle (required for registration bonus)"
        },
        "address": {
          "type": "Object",
          "description": "User's address",
          "fields": {
            "street": {
              "type": "String",
              "maxlength": 200
            },
            "city": {
              "type": "String",
              "maxlength": 100
            },
            "state": {
              "type": "String",
              "maxlength": 100
            },
            "country": {
              "type": "String",
              "maxlength": 100
            },
            "postalCode": {
              "type": "String",
              "maxlength": 20
            },
            "coordinates": {
              "latitude": {
                "type": "Number",
                "min": -90,
                "max": 90
              },
              "longitude": {
                "type": "Number",
                "min": -180,
                "max": 180
              }
            }
          }
        },
        "socialMediaAccounts": {
          "type": "Array<Object>",
          "description": "Social media accounts for verification",
          "itemFields": {
            "platform": {
              "type": "String",
              "enum": ["youtube", "facebook", "tiktok", "instagram", "telegram"],
              "required": true
            },
            "handle": {
              "type": "String"
            },
            "url": {
              "type": "String"
            },
            "isFollowing": {
              "type": "Boolean",
              "default": false
            },
            "verifiedAt": {
              "type": "Date"
            },
            "verificationMethod": {
              "type": "String",
              "enum": ["api", "screenshot", "manual"],
              "default": "manual"
            },
            "followerCount": {
              "type": "Number",
              "min": 0
            },
            "accountAge": {
              "type": "Date"
            },
            "isVerified": {
              "type": "Boolean",
              "default": false
            }
          }
        },
        "idVerification": {
          "type": "Object",
          "description": "ID verification data",
          "fields": {
            "documentType": {
              "type": "String",
              "enum": ["passport", "national_id", "drivers_license", "other"]
            },
            "documentNumber": {
              "type": "String"
            },
            "documentImage": {
              "type": "String",
              "description": "URL to document image"
            },
            "selfieImage": {
              "type": "String",
              "description": "URL to selfie image"
            },
            "status": {
              "type": "String",
              "enum": ["pending", "verified", "rejected", "not_required"],
              "default": "pending"
            },
            "verifiedAt": {
              "type": "Date"
            },
            "rejectionReason": {
              "type": "String"
            },
            "verifiedBy": {
              "type": "ObjectId",
              "ref": "User"
            }
          }
        },
        "referralCode": {
          "type": "String",
          "unique": true,
          "sparse": true,
          "description": "User's referral code"
        },
        "referredBy": {
          "type": "ObjectId",
          "ref": "User",
          "description": "User who referred this user"
        },
        "completionPercentage": {
          "type": "Number",
          "default": 0,
          "min": 0,
          "max": 100,
          "description": "Profile completion percentage"
        },
        "completedFields": {
          "type": "Array<String>",
          "description": "List of completed profile fields"
        },
        "missingFields": {
          "type": "Array<String>",
          "description": "List of missing profile fields"
        },
        "lastUpdated": {
          "type": "Date",
          "default": "Date.now",
          "description": "Last profile update"
        },
        "deviceFingerprints": {
          "type": "Array<String>",
          "description": "All device fingerprints used (fraud detection)"
        },
        "ipAddresses": {
          "type": "Array<String>",
          "description": "All IP addresses used (fraud detection)"
        },
        "registrationMetadata": {
          "type": "Object",
          "description": "Registration metadata for fraud detection",
          "fields": {
            "userAgent": "String",
            "language": "String",
            "timezone": "String",
            "screen": "String",
            "platform": "String"
          }
        },
        "isProfileVerified": {
          "type": "Boolean",
          "default": false,
          "description": "Whether profile has been verified"
        },
        "profileVerifiedAt": {
          "type": "Date",
          "description": "When profile was verified"
        },
        "profileVerifiedBy": {
          "type": "ObjectId",
          "ref": "User",
          "description": "Admin who verified the profile"
        },
        "securityFlags": {
          "type": "Array<String>",
          "description": "Security flags for this profile"
        },
        "validationHistory": {
          "type": "Array<Object>",
          "description": "History of validation attempts",
          "itemFields": {
            "date": "Date",
            "result": "Boolean",
            "flags": "Array<String>"
          }
        },
        "adminVerified": {
          "type": "Boolean",
          "default": false,
          "description": "Manual admin verification status"
        },
        "adminVerifiedBy": {
          "type": "String",
          "description": "Admin who verified"
        },
        "adminVerifiedAt": {
          "type": "Date",
          "description": "When admin verified"
        },
        "adminNotes": {
          "type": "String",
          "maxlength": 500,
          "description": "Admin notes on profile"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "relationships": {
        "userId": {
          "type": "one-to-one",
          "model": "User",
          "description": "User this profile belongs to"
        },
        "referredBy": {
          "type": "one-to-one",
          "model": "User",
          "description": "User who referred this user"
        }
      },
      "methods": {
        "calculateCompletionPercentage": {
          "params": [],
          "returns": "number",
          "description": "Calculate profile completion percentage (80% basic fields, 20% social media)"
        },
        "updateCompletionStatus": {
          "params": [],
          "returns": "void",
          "description": "Update completion percentage and field lists"
        }
      },
      "hooks": {
        "pre-save": [
          "Auto-update completion status before saving"
        ]
      },
      "indexes": [
        "userId (unique)",
        "completionPercentage",
        "isProfileVerified",
        "deviceFingerprints",
        "ipAddresses",
        "fullName, email (text)",
        "address.city, address.country",
        "referredBy",
        "socialMediaAccounts.platform, socialMediaAccounts.isFollowing"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439031",
        "userId": "507f1f77bcf86cd799439011",
        "fullName": "John Doe",
        "username": "johndoe",
        "dateOfBirth": "1990-05-15T00:00:00.000Z",
        "gender": "male",
        "email": "john.doe@example.com",
        "phone": "+1234567890",
        "deviceFingerprint": "a1b2c3d4e5f6",
        "socialMediaHandle": "@johndoe",
        "address": {
          "street": "123 Main St",
          "city": "New York",
          "state": "NY",
          "country": "USA",
          "postalCode": "10001"
        },
        "socialMediaAccounts": [
          {
            "platform": "facebook",
            "handle": "@johndoe",
            "isFollowing": true,
            "verifiedAt": "2024-01-20T10:00:00.000Z"
          }
        ],
        "idVerification": {
          "documentType": "passport",
          "status": "verified",
          "verifiedAt": "2024-01-25T10:00:00.000Z"
        },
        "completionPercentage": 85,
        "isProfileVerified": true,
        "createdAt": "2024-01-15T10:30:00.000Z",
        "updatedAt": "2024-01-25T10:30:00.000Z"
      }
    },
    "UserPreferences": {
      "modelName": "UserPreferences",
      "collectionName": "userpreferences",
      "description": "User application preferences for theme, notifications, dashboard settings, and accessibility",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true,
          "unique": true
        },
        "theme": {
          "type": "String",
          "enum": ["light", "dark", "auto"],
          "default": "light"
        },
        "language": {
          "type": "String",
          "default": "en"
        },
        "notifications": {
          "type": "Object",
          "fields": {
            "email": {
              "type": "Boolean",
              "default": true
            },
            "push": {
              "type": "Boolean",
              "default": true
            },
            "platform": {
              "type": "Boolean",
              "default": true
            },
            "newsletter": {
              "type": "Boolean",
              "default": true
            }
          }
        },
        "dashboard": {
          "type": "Object",
          "fields": {
            "showWelcomeMessage": {
              "type": "Boolean",
              "default": true
            },
            "showActivityFeed": {
              "type": "Boolean",
              "default": true
            },
            "feedItemsPerPage": {
              "type": "Number",
              "default": 10,
              "min": 5,
              "max": 50
            },
            "compactView": {
              "type": "Boolean",
              "default": false
            }
          }
        },
        "accessibility": {
          "type": "Object",
          "fields": {
            "highContrast": {
              "type": "Boolean",
              "default": false
            },
            "largeText": {
              "type": "Boolean",
              "default": false
            },
            "reducedMotion": {
              "type": "Boolean",
              "default": false
            }
          }
        },
        "privacy": {
          "type": "Object",
          "fields": {
            "showOnlineStatus": {
              "type": "Boolean",
              "default": true
            },
            "shareActivity": {
              "type": "Boolean",
              "default": true
            }
          }
        },
        "customSettings": {
          "type": "Mixed",
          "default": {},
          "description": "Flexible key-value pairs for custom settings"
        },
        "lastUpdated": {
          "type": "Date",
          "default": "Date.now"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "relationships": {
        "user": {
          "type": "one-to-one",
          "model": "User"
        }
      },
      "hooks": {
        "pre-save": [
          "Update lastUpdated timestamp"
        ]
      },
      "indexes": [
        "user (unique)",
        "theme",
        "lastUpdated"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439041",
        "user": "507f1f77bcf86cd799439011",
        "theme": "dark",
        "language": "en",
        "notifications": {
          "email": true,
          "push": true,
          "platform": true,
          "newsletter": false
        },
        "dashboard": {
          "showWelcomeMessage": false,
          "showActivityFeed": true,
          "feedItemsPerPage": 20,
          "compactView": true
        },
        "accessibility": {
          "highContrast": false,
          "largeText": false,
          "reducedMotion": false
        },
        "privacy": {
          "showOnlineStatus": false,
          "shareActivity": true
        },
        "customSettings": {},
        "lastUpdated": "2024-10-10T14:20:00.000Z",
        "createdAt": "2024-01-15T10:30:00.000Z",
        "updatedAt": "2024-10-10T14:20:00.000Z"
      }
    },
    "Stake": {
      "modelName": "Stake",
      "collectionName": "stakes",
      "description": "Goal-based staking system. Stakes target 200% return (100% profit). Weekly distributions based on platform performance.",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true
        },
        "userId": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "amount": {
          "type": "Number",
          "required": true,
          "min": 0
        },
        "goalDescription": {
          "type": "String",
          "trim": true,
          "maxlength": 200
        },
        "duration": {
          "type": "Number",
          "required": true,
          "default": 0,
          "min": 0,
          "description": "0 = permanent stake until 200% (no duration)"
        },
        "status": {
          "type": "String",
          "enum": ["active", "completed", "cancelled", "paused"],
          "default": "active"
        },
        "type": {
          "type": "String",
          "enum": ["regular", "registration_bonus", "referral_bonus"],
          "default": "regular"
        },
        "isRegistrationBonus": {
          "type": "Boolean",
          "default": false
        },
        "registrationBonusId": {
          "type": "ObjectId",
          "ref": "RegistrationBonus"
        },
        "maxReturnMultiplier": {
          "type": "Number",
          "default": 2.0,
          "min": 1.0,
          "max": 3.0,
          "description": "2.0 for regular stakes (200%), 1.0 for bonus stakes (100%)"
        },
        "startDate": {
          "type": "Date",
          "default": "Date.now"
        },
        "endDate": {
          "type": "Date",
          "required": true
        },
        "completedAt": {
          "type": "Date"
        },
        "totalReturnsEarned": {
          "type": "Number",
          "default": 0,
          "min": 0
        },
        "weeklyReturnsHistory": {
          "type": "Array<Object>",
          "description": "History of weekly returns",
          "itemFields": {
            "week": {
              "type": "Number",
              "required": true,
              "min": 1
            },
            "date": {
              "type": "Date",
              "required": true
            },
            "percentage": {
              "type": "Number",
              "required": true,
              "min": 0,
              "max": 100
            },
            "amount": {
              "type": "Number",
              "required": true,
              "min": 0
            },
            "cumulativeAmount": {
              "type": "Number",
              "required": true,
              "min": 0
            },
            "poolSharePercentage": {
              "type": "Number",
              "min": 0,
              "max": 100
            },
            "proRatingFactor": {
              "type": "Number",
              "min": 0,
              "max": 1
            },
            "daysActive": {
              "type": "Number",
              "min": 0,
              "max": 7
            }
          }
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "description": "Legacy alias for userId"
        },
        "isBonus": {
          "type": "Boolean",
          "default": false,
          "description": "Deprecated: Use type instead"
        },
        "roiPaid": {
          "type": "Boolean",
          "default": false,
          "description": "Deprecated: Use status instead"
        },
        "maturityDate": {
          "type": "Date",
          "description": "Deprecated: Use endDate instead"
        },
        "roiAmount": {
          "type": "Number",
          "default": 0,
          "description": "Deprecated: Use totalReturnsEarned instead"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "relationships": {
        "userId": {
          "type": "many-to-one",
          "model": "User",
          "description": "User who created this stake"
        },
        "registrationBonusId": {
          "type": "one-to-one",
          "model": "RegistrationBonus",
          "description": "Registration bonus if this is a bonus stake"
        }
      },
      "virtuals": {
        "progress": {
          "type": "Number",
          "description": "Progress percentage towards max returns (0-100%)"
        },
        "isCompleted": {
          "type": "Boolean",
          "description": "Whether stake has reached max returns"
        },
        "remainingReturns": {
          "type": "Number",
          "description": "Amount remaining to reach max returns"
        }
      },
      "methods": {
        "addWeeklyReturn": {
          "params": ["percentage: number", "week: number"],
          "returns": "number",
          "description": "Add a weekly return, respecting max return limit"
        },
        "getCurrentWeek": {
          "params": [],
          "returns": "number",
          "description": "Calculate current week number since stake start"
        }
      },
      "hooks": {
        "pre-save": [
          "Sync legacy fields for backward compatibility",
          "Auto-complete stake if max returns reached"
        ]
      },
      "indexes": [
        "userId, status",
        "type, status",
        "isRegistrationBonus",
        "endDate, status",
        "startDate (descending)",
        "registrationBonusId"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439051",
        "userId": "507f1f77bcf86cd799439011",
        "amount": 1000,
        "goalDescription": "Save for vacation",
        "duration": 0,
        "status": "active",
        "type": "regular",
        "isRegistrationBonus": false,
        "maxReturnMultiplier": 2.0,
        "startDate": "2024-09-01T00:00:00.000Z",
        "endDate": "2025-09-01T00:00:00.000Z",
        "totalReturnsEarned": 250,
        "weeklyReturnsHistory": [
          {
            "week": 1,
            "date": "2024-09-08T00:00:00.000Z",
            "percentage": 5,
            "amount": 50,
            "cumulativeAmount": 50,
            "poolSharePercentage": 2.5,
            "proRatingFactor": 1.0,
            "daysActive": 7
          },
          {
            "week": 2,
            "date": "2024-09-15T00:00:00.000Z",
            "percentage": 4,
            "amount": 40,
            "cumulativeAmount": 90,
            "poolSharePercentage": 2.0,
            "proRatingFactor": 1.0,
            "daysActive": 7
          }
        ],
        "createdAt": "2024-09-01T00:00:00.000Z",
        "updatedAt": "2024-09-15T00:00:00.000Z"
      }
    },
    "Goal": {
      "modelName": "Goal",
      "collectionName": "goals",
      "description": "Financial goals linked to stakes. Tracks progress towards 200% completion (100% initial + 100% profit).",
      "fields": {
        "_id": {
          "type": "ObjectId",
          "required": true
        },
        "user": {
          "type": "ObjectId",
          "ref": "User",
          "required": true
        },
        "title": {
          "type": "String",
          "required": true,
          "trim": true,
          "maxlength": 100
        },
        "description": {
          "type": "String",
          "trim": true,
          "maxlength": 500
        },
        "category": {
          "type": "String",
          "required": true,
          "trim": true
        },
        "isCustomGoal": {
          "type": "Boolean",
          "default": false,
          "description": "True if user typed custom goal, false if from template"
        },
        "initialStakeAmount": {
          "type": "Number",
          "required": true,
          "min": 20
        },
        "totalReturnsReceived": {
          "type": "Number",
          "default": 0,
          "min": 0
        },
        "progressPercentage": {
          "type": "Number",
          "default": 100,
          "min": 100,
          "max": 200,
          "description": "Starts at 100% (initial stake), targets 200%"
        },
        "lastMotivationalQuote": {
          "type": "String",
          "trim": true
        },
        "lastMilestoneReached": {
          "type": "Number",
          "default": 100,
          "min": 0
        },
        "status": {
          "type": "String",
          "enum": ["active", "completed"],
          "default": "active"
        },
        "stakeDate": {
          "type": "Date",
          "required": true
        },
        "earningStartDate": {
          "type": "Date",
          "required": true,
          "description": "Next day 00:00 Baker Island Time"
        },
        "nextEarningDate": {
          "type": "Date"
        },
        "isEligibleForWeeklyReturn": {
          "type": "Boolean",
          "default": true
        },
        "remainingToTarget": {
          "type": "Number",
          "description": "How much more needed to reach 200%"
        },
        "weeksActive": {
          "type": "Number",
          "default": 0
        },
        "totalWeeksToCompletion": {
          "type": "Number",
          "description": "Estimated weeks to reach 200%"
        },
        "createdAt": {
          "type": "Date",
          "default": "Date.now"
        },
        "updatedAt": {
          "type": "Date",
          "default": "Date.now"
        }
      },
      "relationships": {
        "user": {
          "type": "many-to-one",
          "model": "User"
        }
      },
      "virtuals": {
        "targetTotalAmount": {
          "type": "Number",
          "description": "200% of initial stake (target amount)"
        },
        "isCompleted": {
          "type": "Boolean",
          "description": "Whether goal has reached 200%"
        },
        "currentTotalAmount": {
          "type": "Number",
          "description": "Initial stake + returns received"
        },
        "profitPercentage": {
          "type": "Number",
          "description": "Profit earned as percentage of initial stake"
        }
      },
      "hooks": {
        "pre-save": [
          "Calculate progress percentage",
          "Calculate remaining amount to target",
          "Auto-complete if 200% reached"
        ]
      },
      "indexes": [
        "user, status",
        "user, createdAt (descending)",
        "category",
        "isEligibleForWeeklyReturn, status",
        "earningStartDate"
      ],
      "example": {
        "_id": "507f1f77bcf86cd799439061",
        "user": "507f1f77bcf86cd799439011",
        "title": "Vacation to Bali",
        "description": "Save $2000 for a dream vacation",
        "category": "Travel",
        "isCustomGoal": false,
        "initialStakeAmount": 1000,
        "totalReturnsReceived": 250,
        "progressPercentage": 125,
        "status": "active",
        "stakeDate": "2024-09-01T00:00:00.000Z",
        "earningStartDate": "2024-09-02T00:00:00.000Z",
        "isEligibleForWeeklyReturn": true,
        "remainingToTarget": 750,
        "weeksActive": 5,
        "createdAt": "2024-09-01T00:00:00.000Z",
        "updatedAt": "2024-10-06T00:00:00.000Z"
      }
    }
  }
}
